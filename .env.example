# Aragora Environment Configuration
# Copy this file to .env and fill in your values:
#   cp .env.example .env
#
# Full documentation: docs/ENVIRONMENT.md

# =============================================================================
# PRODUCTION CHECKLIST (Required before deploying to aragora.ai)
# =============================================================================
# [ ] Set ARAGORA_ENVIRONMENT=production
# [ ] Set ARAGORA_SSL_ENABLED=true with valid certificates
# [ ] Set ARAGORA_JWT_SECRET (generate: python -c "import secrets; print(secrets.token_urlsafe(32))")
# [ ] Set ARAGORA_ALLOWED_ORIGINS to your production domain(s) only
# [ ] Configure at least one AI provider API key
# [ ] Set SUPABASE_URL and SUPABASE_KEY for real-time features
# [ ] Set ARAGORA_POSTGRES_DSN with Supabase PostgreSQL connection string
# [ ] Run database initialization: python scripts/init_postgres_db.py
# [ ] Review rate limit settings for production load
# [ ] Set ARAGORA_CSP_REPORT_ONLY=false to enforce Content-Security-Policy
#
# Verification commands:
#   python scripts/init_postgres_db.py --verify   # Verify database tables
#   ARAGORA_ENVIRONMENT=production python -c "import aragora; print('Production ready')"

# =============================================================================
# AI PROVIDER KEYS (At least one required)
# =============================================================================

# Anthropic Claude - https://console.anthropic.com/
ANTHROPIC_API_KEY=

# OpenAI - https://platform.openai.com/api-keys
OPENAI_API_KEY=

# Google Gemini - https://aistudio.google.com/apikey
GEMINI_API_KEY=

# xAI Grok - https://console.x.ai/
XAI_API_KEY=

# Mistral AI - https://console.mistral.ai/
MISTRAL_API_KEY=

# OpenRouter (multi-model: DeepSeek, Llama, Qwen, Yi) - https://openrouter.ai/
OPENROUTER_API_KEY=

# DeepSeek (direct API) - https://platform.deepseek.com/
DEEPSEEK_API_KEY=

# =============================================================================
# LOCAL MODELS (Optional)
# =============================================================================

# Ollama - https://ollama.ai
OLLAMA_HOST=http://localhost:11434
OLLAMA_MODEL=llama2

# LM Studio - https://lmstudio.ai
LM_STUDIO_HOST=http://localhost:1234

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================

# Server port (HTTP + WebSocket on /ws)
ARAGORA_PORT=8080

# Bind address (default 127.0.0.1 for security)
# Use 0.0.0.0 to accept external connections
ARAGORA_BIND_HOST=127.0.0.1

# Environment mode: development or production
# Production enables stricter security (required JWT secret, etc.)
ARAGORA_ENV=development
# Compatibility alias used by some billing/auth modules
ARAGORA_ENVIRONMENT=development

# Data directory for databases and state
ARAGORA_DATA_DIR=.nomic

# =============================================================================
# AGENT DEFAULTS & STREAMING
# =============================================================================

# Default agents when none specified (comma-separated)
ARAGORA_DEFAULT_AGENTS=grok,anthropic-api,openai-api,deepseek,gemini

# Streaming-capable agent allowlist (comma-separated)
ARAGORA_STREAMING_AGENTS=grok,anthropic-api,openai-api

# Streaming buffer size (bytes) and chunk timeout (seconds)
ARAGORA_STREAM_BUFFER_SIZE=10485760
ARAGORA_STREAM_CHUNK_TIMEOUT=180

# =============================================================================
# AUTHENTICATION (Optional in development, required in production)
# =============================================================================

# Simple token auth (development)
ARAGORA_API_TOKEN=

# JWT Configuration (production)
# Generate: python -c "import secrets; print(secrets.token_urlsafe(32))"
ARAGORA_JWT_SECRET=
ARAGORA_JWT_EXPIRY_HOURS=24
ARAGORA_REFRESH_TOKEN_EXPIRY_DAYS=30

# =============================================================================
# PERSISTENCE - SUPABASE (Recommended for Production)
# =============================================================================
# Supabase provides managed PostgreSQL + real-time subscriptions.
# Create a free project at https://supabase.com
#
# 1. Get your project URL and anon/service key from Settings > API
# 2. Get your database connection string from Settings > Database > Connection string
#
# For aragora.ai production, Supabase is the recommended backend.

# Supabase REST API (for real-time subscriptions)
SUPABASE_URL=
SUPABASE_KEY=

# Supabase PostgreSQL connection (for asyncpg stores)
# Format: postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres
# Use the "Transaction" pooler mode connection string for best performance
ARAGORA_POSTGRES_DSN=

# =============================================================================
# CORS CONFIGURATION
# =============================================================================

# Comma-separated allowed origins
# ARAGORA_ALLOWED_ORIGINS=https://myapp.com,https://staging.myapp.com

# =============================================================================
# RATE LIMITING
# =============================================================================

ARAGORA_RATE_LIMIT=60
ARAGORA_IP_RATE_LIMIT=120
ARAGORA_BURST_MULTIPLIER=2.0

# Redis-backed rate limiting (optional)
# ARAGORA_REDIS_URL=redis://localhost:6379/0
# ARAGORA_REDIS_KEY_PREFIX=aragora:ratelimit:
# ARAGORA_REDIS_TTL=120
# ARAGORA_REDIS_MAX_CONNECTIONS=50
# ARAGORA_REDIS_SOCKET_TIMEOUT=5.0

# =============================================================================
# BILLING (Stripe Integration)
# =============================================================================

# Stripe - https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_PRICE_STARTER=
STRIPE_PRICE_PROFESSIONAL=
STRIPE_PRICE_ENTERPRISE=

# =============================================================================
# WEBHOOKS
# =============================================================================

WEBHOOK_URL=
WEBHOOK_SECRET=
# Allow localhost webhook targets (dev only)
# ARAGORA_WEBHOOK_ALLOW_LOCALHOST=false

# =============================================================================
# SOCIAL MEDIA / PULSE MODULE
# =============================================================================

# Twitter/X trending topics - https://developer.twitter.com
TWITTER_BEARER_TOKEN=

# =============================================================================
# TEXT-TO-SPEECH / BROADCAST
# =============================================================================

# TTS backend priority (comma-separated)
# ARAGORA_TTS_ORDER=elevenlabs,xtts,edge-tts,pyttsx3

# ElevenLabs - https://elevenlabs.io
ARAGORA_ELEVENLABS_API_KEY=

# =============================================================================
# LOGGING & OBSERVABILITY
# =============================================================================

ARAGORA_DEBUG=false
ARAGORA_LOG_LEVEL=INFO
# Log format: json (production) or text (development)
ARAGORA_LOG_FORMAT=json
# Include timestamps in logs
ARAGORA_LOG_TIMESTAMP=true
# Log file path (optional, logs to stdout if not set)
# ARAGORA_LOG_FILE=/var/log/aragora/server.log
# ARAGORA_LOG_MAX_BYTES=10485760
# ARAGORA_LOG_BACKUP_COUNT=5

# Telemetry level: SILENT, DIAGNOSTIC, CONTROLLED, SPECTACLE
ARAGORA_TELEMETRY_LEVEL=CONTROLLED

# =============================================================================
# METRICS (Prometheus)
# =============================================================================

# Enable Prometheus metrics endpoint
METRICS_ENABLED=true
# Metrics server port (separate from main server)
METRICS_PORT=9090
# Optional: Token to protect /metrics endpoint (if set, requires token query param or Bearer auth)
# ARAGORA_METRICS_TOKEN=your-secret-metrics-token

# =============================================================================
# SECURITY HEADERS (CSP, HSTS)
# =============================================================================

# Enable Content-Security-Policy header (default: true)
ARAGORA_ENABLE_CSP=true
# CSP mode: "api" (strict), "standard" (web UI), "development" (permissive)
ARAGORA_CSP_MODE=standard
# Use report-only mode instead of enforcement (default: true for safer rollout)
ARAGORA_CSP_REPORT_ONLY=true
# Optional: URI for CSP violation reports
# ARAGORA_CSP_REPORT_URI=https://your-domain.com/csp-report

# =============================================================================
# DISTRIBUTED TRACING (OpenTelemetry)
# =============================================================================

# Enable OpenTelemetry tracing (requires OTLP collector like Jaeger/Tempo)
OTEL_ENABLED=false
# OTLP collector endpoint (gRPC)
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
# Service name for traces
OTEL_SERVICE_NAME=aragora
# Trace sampling rate (0.0-1.0, 1.0 = 100% of traces)
OTEL_SAMPLE_RATE=1.0

# =============================================================================
# ERROR TRACKING (Sentry)
# =============================================================================

# Sentry DSN - https://sentry.io
# SENTRY_DSN=
# SENTRY_ENVIRONMENT=production
# SENTRY_TRACES_SAMPLE_RATE=0.1
# SENTRY_PROFILES_SAMPLE_RATE=0.1
# SENTRY_SERVER_NAME=aragora-prod-1

# =============================================================================
# SLO CONFIGURATION
# =============================================================================

# Override default SLO targets
# SLO_AVAILABILITY_TARGET=0.999
# SLO_LATENCY_P99_TARGET_MS=500
# SLO_DEBATE_SUCCESS_TARGET=0.95

# =============================================================================
# WEBSOCKET CONFIGURATION
# =============================================================================

# WebSocket rate limiting
ARAGORA_WS_CONN_RATE=30
ARAGORA_WS_MAX_PER_IP=10

# Require authentication for WebSocket connections
# ARAGORA_AUTH_REQUIRED=true

# Trusted proxy addresses (comma-separated)
ARAGORA_TRUSTED_PROXIES=127.0.0.1,::1,localhost

# =============================================================================
# SESSION & OAUTH
# =============================================================================

# Redis URL for distributed session storage
# REDIS_URL=redis://localhost:6379/0

# OAuth state TTL (seconds)
# OAUTH_STATE_TTL_SECONDS=600
# OAUTH_MAX_STATES=10000

# =============================================================================
# SECURITY
# =============================================================================

# Rate limit fail-open mode (allow requests if Redis is down)
# ARAGORA_RATE_LIMIT_FAIL_OPEN=false
# ARAGORA_REDIS_FAILURE_THRESHOLD=3

# Maximum concurrent CLI subprocesses
ARAGORA_MAX_CLI_SUBPROCESSES=10

# Maximum concurrent debates
# ARAGORA_MAX_CONCURRENT_DEBATES=10

# =============================================================================
# DATABASE
# =============================================================================
# Backend auto-detection:
# - If ARAGORA_POSTGRES_DSN or DATABASE_URL is set → PostgreSQL
# - Otherwise → SQLite (development fallback)
#
# For aragora.ai production: Use Supabase PostgreSQL (see PERSISTENCE section above)

# Explicit backend override (optional, usually auto-detected)
# ARAGORA_DB_BACKEND=postgres

# --- Option 1: Supabase (Recommended for Production) ---
# Set ARAGORA_POSTGRES_DSN in the PERSISTENCE section above
# The backend will auto-detect PostgreSQL when this is set

# --- Option 2: DATABASE_URL (Alternative Managed PostgreSQL) ---
# Standard connection string format, works with AWS RDS, Neon, etc.
# DATABASE_URL=postgresql://user:password@host:5432/dbname?sslmode=require
#
# Examples:
# AWS RDS:   postgresql://admin:password@mydb.xxxx.us-west-2.rds.amazonaws.com:5432/aragora
# Neon:      postgresql://user:pass@ep-xxx.us-west-2.aws.neon.tech/neondb?sslmode=require

# --- Option 3: Self-Hosted PostgreSQL ---
# ARAGORA_PG_HOST=localhost
# ARAGORA_PG_PORT=5432
# ARAGORA_PG_DATABASE=aragora
# ARAGORA_PG_USER=aragora
# ARAGORA_PG_PASSWORD=
# ARAGORA_PG_SSL_MODE=prefer  # prefer, require, verify-ca, verify-full

# --- Connection Pool Settings ---
ARAGORA_DB_POOL_SIZE=10
ARAGORA_DB_POOL_MAX_OVERFLOW=5
ARAGORA_DB_POOL_TIMEOUT=30.0

# --- SQLite Settings (Development Only) ---
# SQLite is automatically used when no PostgreSQL DSN is configured
# Path relative to ARAGORA_DATA_DIR
ARAGORA_SQLITE_PATH=aragora.db

# =============================================================================
# KNOWLEDGE BASE / WEAVIATE (Vector Search)
# =============================================================================

# Enable Weaviate vector search (requires running Weaviate instance)
# When disabled, uses in-memory embedding service (development only)
ARAGORA_WEAVIATE_ENABLED=false

# Weaviate connection URL
# Local: http://localhost:8080
# Cloud: https://your-cluster.weaviate.cloud
ARAGORA_WEAVIATE_URL=http://localhost:8080

# Weaviate API key (required for Weaviate Cloud Services)
# ARAGORA_WEAVIATE_API_KEY=

# Embedding model for vector search
# Options: all-MiniLM-L6-v2 (local), text-embedding-3-small (OpenAI)
ARAGORA_EMBEDDING_MODEL=all-MiniLM-L6-v2

# Hybrid search alpha (0=pure vector, 1=pure keyword, 0.5=balanced)
ARAGORA_HYBRID_SEARCH_ALPHA=0.5

# Maximum chunks to return from search
ARAGORA_SEARCH_LIMIT=20

# =============================================================================
# QDRANT VECTOR DATABASE (Optional)
# =============================================================================

# Enable Qdrant vector database (recommended for pure vector workloads)
# Uses namespace-based routing: knowledge/memory -> Qdrant, debate/documents -> Weaviate
ARAGORA_QDRANT_ENABLED=false

# Qdrant connection URL
# Local: http://localhost:6333
# Cloud: https://your-cluster.qdrant.cloud
ARAGORA_QDRANT_URL=http://localhost:6333

# Qdrant API key (required for Qdrant Cloud)
# ARAGORA_QDRANT_API_KEY=

# Enable namespace-based backend routing (Qdrant for vectors, Weaviate for hybrid)
# When enabled, automatically selects optimal backend per namespace
VECTOR_NAMESPACE_ROUTING=true

# =============================================================================
# TINKER (Fine-tuning Service)
# =============================================================================

# TINKER_API_KEY=
# TINKER_BASE_MODEL=meta-llama/Llama-3.3-70B-Instruct

# =============================================================================
# YOUTUBE UPLOAD (Optional)
# =============================================================================

# YOUTUBE_CLIENT_ID=
# YOUTUBE_CLIENT_SECRET=
# YOUTUBE_REFRESH_TOKEN=

# =============================================================================
# TWITTER/X POSTING (Optional)
# =============================================================================

# TWITTER_API_KEY=
# TWITTER_API_SECRET=
# TWITTER_ACCESS_TOKEN=
# TWITTER_ACCESS_SECRET=

# =============================================================================
# SMTP / EMAIL (Notifications)
# =============================================================================

# SMTP server for sending emails (password reset, notifications)
# ARAGORA_SMTP_HOST=smtp.example.com
# ARAGORA_SMTP_PORT=587
# ARAGORA_SMTP_USER=
# ARAGORA_SMTP_PASSWORD=
# ARAGORA_SMTP_FROM=noreply@example.com

# =============================================================================
# OAUTH AUTHENTICATION (Google, GitHub)
# =============================================================================

# Google OAuth - https://console.cloud.google.com/apis/credentials
# GOOGLE_OAUTH_CLIENT_ID=
# GOOGLE_OAUTH_CLIENT_SECRET=
#
# Redirect URI - must match Google Cloud Console "Authorized redirect URIs"
# Production (aragora.ai):
# GOOGLE_OAUTH_REDIRECT_URI=https://aragora.ai/api/auth/oauth/google/callback
# Development:
# GOOGLE_OAUTH_REDIRECT_URI=http://localhost:8080/api/auth/oauth/google/callback

# GitHub OAuth - https://github.com/settings/developers
# Create a new OAuth App: https://github.com/settings/applications/new
# GITHUB_OAUTH_CLIENT_ID=
# GITHUB_OAUTH_CLIENT_SECRET=
#
# Redirect URI - must match GitHub OAuth App settings
# Production (aragora.ai):
# GITHUB_OAUTH_REDIRECT_URI=https://aragora.ai/api/auth/oauth/github/callback
# Development:
# GITHUB_OAUTH_REDIRECT_URI=http://localhost:8080/api/auth/oauth/github/callback

# OAuth redirect URLs (where users go after auth)
#
# Production (aragora.ai):
# OAUTH_SUCCESS_URL=https://aragora.ai/auth/callback
# OAUTH_ERROR_URL=https://aragora.ai/auth/error
# OAUTH_ALLOWED_REDIRECT_HOSTS=aragora.ai,www.aragora.ai
#
# Development:
# OAUTH_SUCCESS_URL=http://localhost:3000/auth/callback
# OAUTH_ERROR_URL=http://localhost:3000/auth/error
# OAUTH_ALLOWED_REDIRECT_HOSTS=localhost

# =============================================================================
# SLACK INTEGRATION
# =============================================================================

# Slack bot for debate notifications - https://api.slack.com/apps
# SLACK_BOT_TOKEN=xoxb-...
# SLACK_SIGNING_SECRET=
# SLACK_WEBHOOK_URL=

# =============================================================================
# ADDITIONAL AI PROVIDERS
# =============================================================================

# Kimi (Moonshot AI) - https://platform.moonshot.cn
# KIMI_API_KEY=

# OpenRouter tier (free, paid, enterprise)
# OPENROUTER_TIER=paid

# =============================================================================
# STRIPE METERED BILLING
# =============================================================================

# Metered billing price IDs for usage-based billing
# STRIPE_METERED_DEBATES=
# STRIPE_METERED_TOKENS_INPUT=
# STRIPE_METERED_TOKENS_OUTPUT=
# STRIPE_PRICE_ENTERPRISE_PLUS=

# =============================================================================
# NOMIC LOOP (Self-improvement)
# =============================================================================

# Auto-commit changes during nomic loop (SAFETY: requires explicit opt-in)
# When enabled, changes pass through: propose → review → test → commit
# NOMIC_AUTO_COMMIT=false

# Auto-continue to next cycle without prompting (default ON for loops)
# NOMIC_AUTO_CONTINUE=true

# Maximum cycle timeout in seconds
# NOMIC_MAX_CYCLE_SECONDS=3600

# Directory for nomic state (defaults to .nomic)
# NOMIC_DIR=.nomic

# Enable automatic prompt evolution
# ARAGORA_ALLOW_PROMPT_EVOLVE=false
# ARAGORA_ALLOW_AUTO_EVOLVE=false

# Implementation parallelism settings
# IMPL_MAX_PARALLEL=4
# IMPL_PARALLEL_TASKS=true
# IMPL_COMPLEXITY_TIMEOUT=300

# Verification settings (Phase 4)
# Test timeout in seconds (default 240)
# NOMIC_TEST_TIMEOUT=240
# Run tests in verbose mode
# NOMIC_TEST_VERBOSE=false

# =============================================================================
# ADDITIONAL SECURITY
# =============================================================================

# Encryption key for secrets at rest (REQUIRED IN PRODUCTION)
# Generate: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# ARAGORA_ENCRYPTION_KEY=

# Allow insecure passwords in development
# ARAGORA_ALLOW_INSECURE_PASSWORDS=false

# Enable scope checking for API tokens
# ARAGORA_SCOPE_CHECK=true

# JWT key rotation (for zero-downtime rotation)
# ARAGORA_JWT_SECRET_PREVIOUS=
# ARAGORA_JWT_SECRET_ROTATED_AT=
# ARAGORA_JWT_ROTATION_GRACE_HOURS=24

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Request timeouts (seconds)
# ARAGORA_REQUEST_TIMEOUT=30
# ARAGORA_MAX_REQUEST_TIMEOUT=300
# ARAGORA_SLOW_REQUEST_TIMEOUT=60

# Cache settings
# ARAGORA_CACHE_MAX_ENTRIES=10000
# ARAGORA_CACHE_EVICT_PERCENT=20

# Timeout worker threads
# ARAGORA_TIMEOUT_WORKERS=4

# Audience inbox size for user participation
# ARAGORA_AUDIENCE_INBOX_MAX_SIZE=100

# Blacklist backend (memory, redis)
# ARAGORA_BLACKLIST_BACKEND=memory

# =============================================================================
# HORIZONTAL SCALING (Multi-Instance)
# =============================================================================

# State backend for debate state: "memory" (single instance) or "redis" (multi-instance)
# Redis backend enables sharing debate state across multiple server instances
ARAGORA_STATE_BACKEND=memory

# Redis URL for distributed state (required when STATE_BACKEND=redis)
# ARAGORA_REDIS_URL=redis://localhost:6379

# Unique instance identifier (auto-generated if not set)
# Used for cross-instance event deduplication
# ARAGORA_INSTANCE_ID=instance-1

# =============================================================================
# SSL/TLS (Production)
# =============================================================================

ARAGORA_SSL_ENABLED=false
# ARAGORA_SSL_CERT=/path/to/cert.pem
# ARAGORA_SSL_KEY=/path/to/key.pem
