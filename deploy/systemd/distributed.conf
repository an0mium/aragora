# Aragora Multi-Instance Distributed Mode Configuration
#
# This systemd drop-in configuration enforces distributed mode for
# multi-instance deployments. When multiple EC2 instances run Aragora,
# they MUST share state via PostgreSQL/Redis to avoid split-brain scenarios.
#
# Install to: /etc/systemd/system/aragora.service.d/distributed.conf
# Then run: sudo systemctl daemon-reload && sudo systemctl restart aragora
#
# This file should be deployed to ALL instances in a multi-instance cluster.

[Service]
# Enforce distributed storage requirements
# When true, the server will fail to start if PostgreSQL is not configured
# This prevents silent fallback to SQLite which causes data divergence
Environment="ARAGORA_REQUIRE_DISTRIBUTED=true"

# Mark as multi-instance deployment
# This enables additional safeguards and distributed coordination
Environment="ARAGORA_MULTI_INSTANCE=true"

# Set production environment
# This enables production-grade security and validation
Environment="ARAGORA_ENV=production"

# Do NOT allow single-instance fallback in production
# This ensures distributed state enforcement is not bypassed
Environment="ARAGORA_SINGLE_INSTANCE=false"

# Require database for production workflows
# Ensures PostgreSQL is used for governance, audit, and workflow state
Environment="ARAGORA_REQUIRE_DATABASE=true"
