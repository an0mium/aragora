# Production values for Aragora
# ==================================
# Use this file for production deployments:
#   helm install aragora ./deploy/helm/aragora \
#     --namespace aragora --create-namespace \
#     -f deploy/helm/aragora/values-production.yaml \
#     --set secrets.apiKeys.anthropicApiKey=sk-ant-...
#
# IMPORTANT: Review and customize these values for your environment.
# At minimum, you MUST configure:
# - backend.image.tag: Use a specific version (not "latest")
# - secrets: Set your API keys
# - ingress: Configure your domain and TLS
# - persistence: Verify storage class availability

# --- Backend (High Availability) ---
backend:
  replicaCount: 3
  image:
    repository: ghcr.io/aragora/aragora
    # IMPORTANT: Replace with a specific version tag or SHA digest
    tag: "0.8.0"
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 4Gi
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 20
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 75
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/component
                  operator: In
                  values:
                    - backend
            topologyKey: kubernetes.io/hostname
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: topology.kubernetes.io/zone
      whenUnsatisfiable: ScheduleAnyway
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: backend

# --- Frontend ---
frontend:
  enabled: true
  replicaCount: 2
  image:
    repository: ghcr.io/aragora/aragora-frontend
    tag: "0.8.0"
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 6
    targetCPUUtilizationPercentage: 70

# --- Configuration ---
config:
  logLevel: "INFO"
  logFormat: "json"
  environment: "production"
  allowedOrigins: "https://aragora.example.com"
  dbBackend: "postgres"

# --- Secrets (set via --set or external secret) ---
secrets:
  create: true
  apiKeys:
    anthropicApiKey: ""
    openaiApiKey: ""
    openrouterApiKey: ""

# --- Ingress ---
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "120"
  host: aragora.example.com  # CHANGE THIS
  tls:
    enabled: true
    secretName: aragora-tls

# --- Persistence ---
persistence:
  enabled: true
  storageClass: ""
  size: 20Gi

# --- PostgreSQL (HA) ---
postgresql:
  enabled: true
  architecture: replication
  auth:
    database: aragora
    username: aragora
  primary:
    persistence:
      enabled: true
      size: 20Gi
  readReplicas:
    replicaCount: 2
    persistence:
      enabled: true
      size: 20Gi

# --- Redis (HA) ---
redis:
  enabled: true
  architecture: replication
  auth:
    enabled: true
  master:
    persistence:
      enabled: true
      size: 8Gi
  replica:
    replicaCount: 2
    persistence:
      enabled: true
      size: 8Gi

# --- Monitoring ---
serviceMonitor:
  enabled: true
  interval: "15s"

# --- Availability ---
podDisruptionBudget:
  enabled: true
  minAvailable: 2

# --- Security ---
networkPolicy:
  enabled: true
