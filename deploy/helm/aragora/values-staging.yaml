# Staging Environment Values for Aragora
# Use with: helm install aragora ./deploy/helm/aragora \
#   --namespace aragora-staging --create-namespace \
#   -f deploy/helm/aragora/values-staging.yaml

# --- Backend (reduced for cost efficiency) ---
backend:
  replicaCount: 1
  image:
    repository: ghcr.io/aragora/aragora
    tag: "staging"
    pullPolicy: Always
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
    prometheus.io/path: "/metrics"
  autoscaling:
    enabled: false

# --- Frontend ---
frontend:
  enabled: true
  replicaCount: 1
  image:
    repository: ghcr.io/aragora/aragora-frontend
    tag: "staging"
    pullPolicy: Always
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  autoscaling:
    enabled: false

# --- Configuration ---
config:
  logLevel: "DEBUG"
  logFormat: "json"
  environment: "staging"
  allowedOrigins: "https://staging.aragora.ai"
  rateLimitMaxRequests: "1000"
  dbBackend: "postgres"

# --- Secrets (from External Secrets Operator) ---
secrets:
  create: false
  existingSecret: "aragora-staging-secrets"

# --- Ingress ---
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-staging
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
  host: staging.aragora.ai
  tls:
    enabled: true
    secretName: aragora-staging-tls

# --- Persistence ---
persistence:
  enabled: true
  size: 5Gi

# --- PostgreSQL (staging) ---
postgresql:
  enabled: true
  auth:
    database: aragora
    username: aragora
    existingSecret: "aragora-staging-secrets"
  primary:
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi
    persistence:
      size: 10Gi

# --- Redis (standalone for staging) ---
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: true
    existingSecret: "aragora-staging-secrets"
    existingSecretPasswordKey: "redis-password"
  master:
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 256Mi
    persistence:
      size: 5Gi

# --- Monitoring ---
serviceMonitor:
  enabled: true
  interval: "30s"
  labels:
    environment: staging

# --- No PDB for easier deployments ---
podDisruptionBudget:
  enabled: false

# --- Network policies disabled for easier debugging ---
networkPolicy:
  enabled: false
