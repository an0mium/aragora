{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "title": "Aragora Helm Chart Values",
  "description": "JSON Schema for validating Aragora Helm chart values",
  "type": "object",
  "required": ["backend", "config", "secrets"],
  "properties": {
    "nameOverride": { "type": "string" },
    "fullnameOverride": { "type": "string" },
    "imagePullSecrets": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": { "name": { "type": "string" } }
      }
    },
    "backend": {
      "type": "object",
      "description": "Backend API server configuration",
      "required": ["replicaCount", "image"],
      "properties": {
        "replicaCount": { "type": "integer", "minimum": 1 },
        "image": {
          "type": "object",
          "required": ["repository"],
          "properties": {
            "repository": { "type": "string" },
            "tag": { "type": "string" },
            "pullPolicy": {
              "type": "string",
              "enum": ["Always", "IfNotPresent", "Never"]
            }
          }
        },
        "resources": { "$ref": "#/$defs/resources" },
        "extraEnv": { "type": "array", "items": { "type": "object" } },
        "podAnnotations": { "type": "object" },
        "nodeSelector": { "type": "object" },
        "tolerations": { "type": "array", "items": { "type": "object" } },
        "affinity": { "type": "object" },
        "topologySpreadConstraints": { "type": "array", "items": { "type": "object" } },
        "service": {
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["ClusterIP", "NodePort", "LoadBalancer"] },
            "port": { "type": "integer", "minimum": 1, "maximum": 65535 },
            "wsPort": { "type": "integer", "minimum": 1, "maximum": 65535 },
            "annotations": { "type": "object" }
          }
        },
        "livenessProbe": { "$ref": "#/$defs/httpProbe" },
        "readinessProbe": { "$ref": "#/$defs/httpProbe" },
        "startupProbe": { "$ref": "#/$defs/httpProbe" },
        "autoscaling": { "$ref": "#/$defs/autoscaling" }
      }
    },
    "frontend": {
      "type": "object",
      "description": "Frontend Next.js application configuration",
      "properties": {
        "enabled": { "type": "boolean" },
        "replicaCount": { "type": "integer", "minimum": 1 },
        "image": {
          "type": "object",
          "properties": {
            "repository": { "type": "string" },
            "tag": { "type": "string" },
            "pullPolicy": {
              "type": "string",
              "enum": ["Always", "IfNotPresent", "Never"]
            }
          }
        },
        "resources": { "$ref": "#/$defs/resources" },
        "extraEnv": { "type": "array", "items": { "type": "object" } },
        "podAnnotations": { "type": "object" },
        "nodeSelector": { "type": "object" },
        "tolerations": { "type": "array", "items": { "type": "object" } },
        "affinity": { "type": "object" },
        "service": {
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["ClusterIP", "NodePort", "LoadBalancer"] },
            "port": { "type": "integer", "minimum": 1, "maximum": 65535 },
            "annotations": { "type": "object" }
          }
        },
        "livenessProbe": { "$ref": "#/$defs/httpProbe" },
        "readinessProbe": { "$ref": "#/$defs/httpProbe" },
        "autoscaling": { "$ref": "#/$defs/autoscaling" }
      }
    },
    "serviceAccount": {
      "type": "object",
      "properties": {
        "create": { "type": "boolean" },
        "annotations": { "type": "object" },
        "name": { "type": "string" }
      }
    },
    "podSecurityContext": {
      "type": "object",
      "properties": {
        "runAsNonRoot": { "type": "boolean" },
        "runAsUser": { "type": "integer", "minimum": 0 },
        "runAsGroup": { "type": "integer", "minimum": 0 },
        "fsGroup": { "type": "integer", "minimum": 0 },
        "seccompProfile": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["RuntimeDefault", "Localhost", "Unconfined"]
            }
          }
        }
      }
    },
    "securityContext": {
      "type": "object",
      "properties": {
        "allowPrivilegeEscalation": { "type": "boolean" },
        "readOnlyRootFilesystem": { "type": "boolean" },
        "capabilities": {
          "type": "object",
          "properties": {
            "drop": { "type": "array", "items": { "type": "string" } },
            "add": { "type": "array", "items": { "type": "string" } }
          }
        }
      }
    },
    "ingress": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "className": { "type": "string" },
        "annotations": { "type": "object" },
        "host": { "type": "string" },
        "tls": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "secretName": { "type": "string" }
          }
        }
      }
    },
    "config": {
      "type": "object",
      "description": "Non-secret application configuration",
      "properties": {
        "bindHost": { "type": "string" },
        "apiPort": { "type": "string" },
        "wsPort": { "type": "string" },
        "logLevel": {
          "type": "string",
          "enum": ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"]
        },
        "logFormat": { "type": "string", "enum": ["json", "text"] },
        "environment": { "type": "string" },
        "allowedOrigins": { "type": "string" },
        "canonicalStorePersist": { "type": "string" },
        "storeDir": { "type": "string" },
        "rateLimitEnabled": { "type": "string" },
        "rateLimitWindow": { "type": "string" },
        "rateLimitMaxRequests": { "type": "string" },
        "dbBackend": { "type": "string", "enum": ["auto", "postgres", "sqlite"] }
      }
    },
    "secrets": {
      "type": "object",
      "description": "Secret configuration for API keys and credentials",
      "properties": {
        "create": { "type": "boolean" },
        "existingSecret": { "type": "string" },
        "apiKeys": {
          "type": "object",
          "properties": {
            "anthropicApiKey": { "type": "string" },
            "openaiApiKey": { "type": "string" },
            "openrouterApiKey": { "type": "string" },
            "mistralApiKey": { "type": "string" },
            "geminiApiKey": { "type": "string" },
            "xaiApiKey": { "type": "string" }
          }
        },
        "aragoraApiToken": { "type": "string" },
        "aragoraSecretKey": { "type": "string" },
        "database": {
          "type": "object",
          "properties": {
            "postgresUrl": { "type": "string" },
            "redisUrl": { "type": "string" }
          }
        }
      }
    },
    "persistence": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "storageClass": { "type": "string" },
        "accessModes": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["ReadWriteOnce", "ReadOnlyMany", "ReadWriteMany"]
          }
        },
        "size": { "type": "string" },
        "annotations": { "type": "object" }
      }
    },
    "postgresql": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "auth": {
          "type": "object",
          "properties": {
            "database": { "type": "string" },
            "username": { "type": "string" },
            "password": { "type": "string" },
            "existingSecret": { "type": "string" }
          }
        }
      }
    },
    "redis": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "architecture": {
          "type": "string",
          "enum": ["standalone", "replication"]
        },
        "auth": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" }
          }
        }
      }
    },
    "externalDatabase": {
      "type": "object",
      "properties": {
        "host": { "type": "string" },
        "port": { "type": "integer", "minimum": 1, "maximum": 65535 },
        "database": { "type": "string" },
        "existingSecret": { "type": "string" }
      }
    },
    "externalRedis": {
      "type": "object",
      "properties": {
        "host": { "type": "string" },
        "port": { "type": "integer", "minimum": 1, "maximum": 65535 },
        "existingSecret": { "type": "string" }
      }
    },
    "networkPolicy": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" }
      }
    },
    "serviceMonitor": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "interval": { "type": "string" },
        "path": { "type": "string" },
        "labels": { "type": "object" }
      }
    },
    "podDisruptionBudget": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "minAvailable": { "type": "integer", "minimum": 0 }
      }
    }
  },
  "$defs": {
    "resources": {
      "type": "object",
      "properties": {
        "requests": {
          "type": "object",
          "properties": {
            "cpu": { "type": "string" },
            "memory": { "type": "string" }
          }
        },
        "limits": {
          "type": "object",
          "properties": {
            "cpu": { "type": "string" },
            "memory": { "type": "string" }
          }
        }
      }
    },
    "httpProbe": {
      "type": "object",
      "properties": {
        "httpGet": {
          "type": "object",
          "properties": {
            "path": { "type": "string" },
            "port": { "type": ["string", "integer"] }
          }
        },
        "initialDelaySeconds": { "type": "integer", "minimum": 0 },
        "periodSeconds": { "type": "integer", "minimum": 1 },
        "timeoutSeconds": { "type": "integer", "minimum": 1 },
        "failureThreshold": { "type": "integer", "minimum": 1 }
      }
    },
    "autoscaling": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "minReplicas": { "type": "integer", "minimum": 1 },
        "maxReplicas": { "type": "integer", "minimum": 1 },
        "targetCPUUtilizationPercentage": { "type": "integer", "minimum": 1, "maximum": 100 },
        "targetMemoryUtilizationPercentage": { "type": "integer", "minimum": 1, "maximum": 100 }
      }
    }
  }
}
