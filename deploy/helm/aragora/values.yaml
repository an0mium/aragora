# =============================================================================
# Aragora Helm Chart - Default Values
# =============================================================================
# Override these values for your environment. At minimum, you must provide
# at least one AI provider API key via secrets.apiKeys.
# =============================================================================

# -- Override chart name
nameOverride: ""
# -- Override fully qualified chart name
fullnameOverride: ""

# -- Global image pull secrets
imagePullSecrets: []

# =============================================================================
# Backend Configuration
# =============================================================================
backend:
  # -- Number of backend replicas (ignored when autoscaling is enabled)
  replicaCount: 2

  image:
    # -- Backend image repository
    repository: ghcr.io/aragora/aragora
    # -- Backend image tag (defaults to Chart.appVersion)
    tag: ""
    # -- Image pull policy
    pullPolicy: IfNotPresent

  # -- Backend resource requests and limits
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 4Gi

  # -- Additional environment variables for the backend
  # Example:
  #   extraEnv:
  #     - name: ARAGORA_ENV
  #       value: production
  extraEnv: []

  # -- Pod annotations for backend pods
  podAnnotations: {}

  # -- Node selector for backend pods
  nodeSelector: {}

  # -- Tolerations for backend pods
  tolerations: []

  # -- Affinity rules for backend pods
  affinity: {}

  # -- Topology spread constraints for backend pods
  topologySpreadConstraints: []

  service:
    # -- Backend service type
    type: ClusterIP
    # -- Backend HTTP API port
    port: 8080
    # -- Backend WebSocket port
    wsPort: 8765
    # -- Service annotations
    annotations: {}

  # -- Liveness probe for backend
  livenessProbe:
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  # -- Readiness probe for backend
  readinessProbe:
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  # -- Startup probe for backend (generous for cold starts)
  startupProbe:
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 5
    failureThreshold: 12

  autoscaling:
    # -- Enable Horizontal Pod Autoscaler for backend
    enabled: false
    # -- Minimum replicas
    minReplicas: 2
    # -- Maximum replicas
    maxReplicas: 10
    # -- Target CPU utilization percentage
    targetCPUUtilizationPercentage: 70
    # -- Target memory utilization percentage
    targetMemoryUtilizationPercentage: 80

# =============================================================================
# Frontend Configuration
# =============================================================================
frontend:
  # -- Enable frontend deployment
  enabled: true

  # -- Number of frontend replicas
  replicaCount: 2

  image:
    # -- Frontend image repository
    repository: ghcr.io/aragora/aragora-frontend
    # -- Frontend image tag (defaults to Chart.appVersion)
    tag: ""
    # -- Image pull policy
    pullPolicy: IfNotPresent

  # -- Frontend resource requests and limits
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # -- Additional environment variables for the frontend
  extraEnv: []

  # -- Pod annotations for frontend pods
  podAnnotations: {}

  # -- Node selector for frontend pods
  nodeSelector: {}

  # -- Tolerations for frontend pods
  tolerations: []

  # -- Affinity rules for frontend pods
  affinity: {}

  service:
    # -- Frontend service type
    type: ClusterIP
    # -- Frontend port
    port: 3000
    # -- Service annotations
    annotations: {}

  # -- Liveness probe for frontend
  livenessProbe:
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3

  # -- Readiness probe for frontend
  readinessProbe:
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  autoscaling:
    # -- Enable Horizontal Pod Autoscaler for frontend
    enabled: false
    # -- Minimum replicas
    minReplicas: 2
    # -- Maximum replicas
    maxReplicas: 6
    # -- Target CPU utilization percentage
    targetCPUUtilizationPercentage: 70

# =============================================================================
# Service Account
# =============================================================================
serviceAccount:
  # -- Create a dedicated service account
  create: true
  # -- Annotations for the service account (e.g., for IAM roles)
  annotations: {}
  # -- Service account name (auto-generated if empty)
  name: ""

# =============================================================================
# Pod Security
# =============================================================================
# -- Pod-level security context (applies to all containers in the pod)
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

# -- Container-level security context
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# =============================================================================
# Ingress
# =============================================================================
ingress:
  # -- Enable ingress resource
  enabled: false
  # -- Ingress class name (e.g., nginx, traefik, alb)
  className: ""
  # -- Ingress annotations
  annotations: {}
    # cert-manager.io/cluster-issuer: letsencrypt-prod
    # nginx.ingress.kubernetes.io/proxy-body-size: 50m
    # nginx.ingress.kubernetes.io/proxy-read-timeout: "120"

  # -- Hostname for the ingress
  host: aragora.example.com

  tls:
    # -- Enable TLS
    enabled: false
    # -- TLS secret name (auto-generated by cert-manager if annotations set)
    secretName: aragora-tls

# =============================================================================
# Application Configuration (non-secret)
# =============================================================================
config:
  # -- Server bind host
  bindHost: "0.0.0.0"
  # -- HTTP API port (internal)
  apiPort: "8080"
  # -- WebSocket port (internal)
  wsPort: "8765"
  # -- Log level (DEBUG, INFO, WARNING, ERROR)
  logLevel: "INFO"
  # -- Log format (json or text)
  logFormat: "json"
  # -- Environment name
  environment: "production"
  # -- CORS allowed origins (comma-separated or *)
  allowedOrigins: "*"
  # -- Enable canonical bead/convoy store persistence
  canonicalStorePersist: "1"
  # -- Bead/convoy store directory
  storeDir: "/app/data/.aragora_beads"
  # -- Enable rate limiting
  rateLimitEnabled: "true"
  # -- Rate limit window in seconds
  rateLimitWindow: "60"
  # -- Maximum requests per window
  rateLimitMaxRequests: "100"
  # -- Database backend (auto, postgres, sqlite)
  dbBackend: "auto"

# =============================================================================
# Secrets
# =============================================================================
secrets:
  # -- Create a Kubernetes Secret with API keys and credentials.
  # Set to false if you manage secrets externally (e.g., External Secrets Operator).
  create: true

  apiKeys:
    # -- Anthropic API key (at least one AI provider key is required)
    anthropicApiKey: ""
    # -- OpenAI API key
    openaiApiKey: ""
    # -- OpenRouter API key (fallback provider)
    openrouterApiKey: ""
    # -- Mistral API key
    mistralApiKey: ""
    # -- Gemini API key
    geminiApiKey: ""
    # -- xAI / Grok API key
    xaiApiKey: ""

  # -- Aragora API token for authenticating requests
  aragoraApiToken: ""
  # -- Aragora secret key for session signing
  aragoraSecretKey: ""

  database:
    # -- PostgreSQL connection string
    postgresUrl: ""
    # -- Redis connection string
    redisUrl: ""

  # -- Reference an existing secret instead of creating one.
  # When set, secrets.create is ignored and this secret is used.
  existingSecret: ""

# =============================================================================
# Persistence (PVC for data directory)
# =============================================================================
persistence:
  # -- Enable persistent volume for backend data
  enabled: true
  # -- Storage class (empty string uses cluster default)
  storageClass: ""
  # -- Access modes
  accessModes:
    - ReadWriteOnce
  # -- Volume size
  size: 10Gi
  # -- PVC annotations
  annotations: {}

# =============================================================================
# PostgreSQL Subchart
# =============================================================================
postgresql:
  # -- Deploy PostgreSQL as a subchart
  enabled: false
  auth:
    database: aragora
    username: aragora
    # -- Use an existing secret for PostgreSQL password
    existingSecret: ""
    # -- Password (only if existingSecret is empty; not recommended for production)
    password: ""

# =============================================================================
# Redis Subchart
# =============================================================================
redis:
  # -- Deploy Redis as a subchart
  enabled: false
  architecture: standalone
  auth:
    enabled: false

# =============================================================================
# External Database (when postgresql.enabled is false)
# =============================================================================
externalDatabase:
  # -- External PostgreSQL host
  host: ""
  # -- External PostgreSQL port
  port: 5432
  # -- Database name
  database: "aragora"
  # -- Existing secret containing the DATABASE_URL key
  existingSecret: ""

# =============================================================================
# External Redis (when redis.enabled is false)
# =============================================================================
externalRedis:
  # -- External Redis host
  host: ""
  # -- External Redis port
  port: 6379
  # -- Existing secret containing the REDIS_URL key
  existingSecret: ""

# =============================================================================
# Network Policies
# =============================================================================
networkPolicy:
  # -- Enable network policies for pod-level firewalling
  enabled: false

# =============================================================================
# ServiceMonitor (Prometheus Operator)
# =============================================================================
serviceMonitor:
  # -- Enable ServiceMonitor for Prometheus scraping
  enabled: false
  # -- Scrape interval
  interval: "15s"
  # -- Metrics path
  path: "/metrics"
  # -- Additional labels for the ServiceMonitor
  labels: {}

# =============================================================================
# Pod Disruption Budget
# =============================================================================
podDisruptionBudget:
  # -- Enable PDB for backend pods
  enabled: false
  # -- Minimum available pods during disruptions
  minAvailable: 1
