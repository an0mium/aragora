# Default values for Aragora
# This is a YAML-formatted file.

# Replica count
replicaCount: 1

# Image configuration
image:
  repository: aragora/aragora
  tag: "latest"
  pullPolicy: IfNotPresent

# Image pull secrets
imagePullSecrets: []

# Override name
nameOverride: ""
fullnameOverride: ""

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod annotations
podAnnotations: {}

# Pod security context (PSS restricted-compatible)
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

# Container security context (PSS restricted-compatible)
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# Service configuration
service:
  type: ClusterIP
  port: 8080
  annotations: {}

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: aragora.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: aragora-tls
  #    hosts:
  #      - aragora.local

# Resource limits
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 100m
    memory: 256Mi

# Autoscaling (Horizontal Pod Autoscaler)
autoscaling:
  enabled: false  # Set to true for production
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  # Scale down behavior (conservative to prevent flapping)
  scaleDown:
    stabilizationWindowSeconds: 300  # 5 min cooldown before scaling down
    percentValue: 25  # Scale down by max 25% at a time
    periodSeconds: 60
  # Scale up behavior (aggressive to handle load spikes)
  scaleUp:
    stabilizationWindowSeconds: 60  # Quick scale up on demand
    percentValue: 100  # Can double pods if needed
    podsValue: 4  # Or add up to 4 pods
    periodSeconds: 15

# Pod Disruption Budget (ensures HA during maintenance)
podDisruptionBudget:
  enabled: false  # Set to true for production
  minAvailable: 1
  # Alternative: maxUnavailable: 1

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Liveness probe
livenessProbe:
  httpGet:
    path: /api/health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Readiness probe
readinessProbe:
  httpGet:
    path: /api/health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Application configuration
config:
  # Server settings
  port: 8080
  logLevel: INFO
  logFormat: json  # json or text

  # API keys (use secrets in production)
  anthropicApiKey: ""
  openaiApiKey: ""
  openrouterApiKey: ""

  # Supabase (optional)
  supabaseUrl: ""
  supabaseKey: ""

  # Redis (for rate limiting and caching)
  redisUrl: ""

  # CORS
  allowedOrigins: "*"

  # Rate limiting
  rateLimitEnabled: true
  rateLimitWindow: 60
  rateLimitMaxRequests: 100

# External secrets (reference existing secrets)
existingSecrets:
  apiKeys: ""  # Name of secret containing API keys
  database: ""  # Name of secret containing database credentials

# Redis subchart (disabled by default, use external)
redis:
  enabled: false
  architecture: standalone
  auth:
    enabled: false

# PostgreSQL subchart (disabled by default)
postgresql:
  enabled: false
  auth:
    database: aragora
    username: aragora
    existingSecret: ""  # Name of secret containing postgresql-password

# PostgreSQL configuration (when using external Postgres)
postgres:
  enabled: false
  dsn: ""  # Full connection string (use existingSecret in production)
  existingSecret: ""  # Secret containing DATABASE_URL
  # Connection pool settings
  poolMinSize: 5
  poolMaxSize: 20

# Persistence (for local storage mode)
persistence:
  enabled: false
  storageClass: ""
  accessModes:
    - ReadWriteOnce
  size: 10Gi
  annotations: {}

# ServiceMonitor for Prometheus Operator
serviceMonitor:
  enabled: false  # Set to true when using Prometheus Operator
  port: metrics
  path: /metrics
  interval: 15s
  scrapeTimeout: 10s
  honorLabels: false
  labels: {}
  # Additional labels for ServiceMonitor (e.g., for Prometheus selector)
  # labels:
  #   release: prometheus
  metricRelabelings: []
  relabelings: []

# PrometheusRule for alerts (requires Prometheus Operator)
prometheusRule:
  enabled: false
  labels: {}
  # Alerting rules - see deploy/monitoring/alerts.yaml for examples
  rules: []
