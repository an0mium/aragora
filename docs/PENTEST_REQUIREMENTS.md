# Penetration Testing Requirements & Scope

**Document Version:** 1.0
**Created:** January 23, 2026
**Status:** Ready for Vendor Engagement
**SOC 2 Gap:** GAP-CC7-01

---

## Executive Summary

This document defines the scope, requirements, and methodology for Aragora's external penetration test. Completion of this test is the **final requirement** for SOC 2 Type II audit readiness.

**Current Security Posture:**
- 0 HIGH severity Bandit issues
- 0 hardcoded secrets detected
- 45,100+ automated tests
- RBAC v2 with 50+ permissions
- Rate limiting on all endpoints
- Circuit breaker protection

---

## Test Scope

### In-Scope Systems

#### 1. Web Application (Primary)
| Component | URL Pattern | Priority |
|-----------|-------------|----------|
| REST API | `/api/v1/*` | HIGH |
| WebSocket API | `/ws/*` | HIGH |
| GraphQL API | `/api/graphql` | MEDIUM |
| Admin Dashboard | `/admin/*` | HIGH |
| Public Pages | `/`, `/docs/*` | LOW |

#### 2. Authentication & Authorization
| Component | Description | Priority |
|-----------|-------------|----------|
| JWT Authentication | Token generation, validation, refresh | CRITICAL |
| API Key Management | Creation, rotation, revocation | HIGH |
| OIDC/SAML SSO | `/api/v1/auth/sso/*` endpoints | HIGH |
| MFA (TOTP/HOTP) | Multi-factor enrollment and verification | HIGH |
| RBAC v2 | Permission checks, role hierarchy | HIGH |
| Multi-tenancy | Tenant isolation (`org_id` boundaries) | CRITICAL |

#### 3. Data Storage & Processing
| Component | Description | Priority |
|-----------|-------------|----------|
| Database Access | SQLite/PostgreSQL query patterns | HIGH |
| File Upload | Document ingestion endpoints | HIGH |
| Knowledge Mound | Knowledge storage and retrieval | MEDIUM |
| Memory Systems | Debate context and learning storage | MEDIUM |

#### 4. External Integrations
| Integration | Endpoints | Priority |
|-------------|-----------|----------|
| Slack Connector | `/api/v1/connectors/slack/*` | MEDIUM |
| Discord Connector | `/api/v1/connectors/discord/*` | MEDIUM |
| GitHub Connector | `/api/v1/connectors/github/*` | MEDIUM |
| Webhook Handlers | `/api/v1/webhooks/*` | HIGH |
| OAuth Callbacks | `/api/v1/auth/sso/callback` | HIGH |

### Out-of-Scope
- Third-party cloud infrastructure (AWS/GCP) - covered by provider SOC 2
- AI model providers (Anthropic, OpenAI) - external services
- Physical security testing
- Social engineering attacks
- Denial of Service (DoS) testing against production

---

## Test Methodology

### Required Testing Types

#### 1. Black Box Testing (External Perspective)
- Unauthenticated API enumeration
- Authentication bypass attempts
- Rate limiting verification
- Error message information disclosure

#### 2. Gray Box Testing (Authenticated User)
- Horizontal privilege escalation (cross-tenant access)
- Vertical privilege escalation (user â†’ admin)
- RBAC bypass testing
- Session management testing

#### 3. White Box Testing (Code-Assisted)
- Source code review for critical paths:
  - `aragora/auth/` - Authentication handlers
  - `aragora/rbac/` - Authorization logic
  - `aragora/tenancy/` - Tenant isolation
  - `aragora/server/handlers/` - API endpoints
- Configuration review
- Secrets management validation

---

## Vulnerability Categories (OWASP Top 10 2021)

| Category | Test Focus | Critical Paths |
|----------|------------|----------------|
| **A01: Broken Access Control** | Tenant isolation, RBAC bypass | `/api/v1/*` with org_id |
| **A02: Cryptographic Failures** | TLS config, token security, hashing | JWT signing, password storage |
| **A03: Injection** | SQL, NoSQL, Command, LDAP | All query endpoints |
| **A04: Insecure Design** | Business logic flaws | Debate flow, voting |
| **A05: Security Misconfiguration** | Headers, CORS, defaults | Server configuration |
| **A06: Vulnerable Components** | Dependency vulnerabilities | Python/JS packages |
| **A07: Auth Failures** | Session handling, credential stuffing | Login, token refresh |
| **A08: Data Integrity Failures** | Deserialization, CI/CD | Webhook processing |
| **A09: Logging Failures** | Audit completeness | Security event logging |
| **A10: SSRF** | Internal resource access | URL fetch features |

---

## Specific Test Cases

### Critical Priority

1. **Multi-Tenant Isolation**
   - Attempt to access Tenant B's debates from Tenant A credentials
   - Test `org_id` enforcement across all endpoints
   - Verify database query isolation

2. **Authentication Bypass**
   - JWT token manipulation (algorithm confusion, signature bypass)
   - API key privilege escalation
   - Session fixation/hijacking

3. **Injection Attacks**
   - SQL injection in search endpoints (`/api/v1/search/*`)
   - Command injection in file processing
   - Template injection in notification systems

4. **IDOR (Insecure Direct Object Reference)**
   - Access debate by ID across tenant boundary
   - Retrieve user data via predictable IDs
   - Download files without authorization

### High Priority

5. **Rate Limiting Bypass**
   - Test `aragora/resilience.py` circuit breakers
   - Verify per-tenant rate limits
   - Check IP-based vs token-based limiting

6. **WebSocket Security**
   - Authentication on WS upgrade
   - Message injection between sessions
   - Cross-tenant event leakage

7. **File Upload Vulnerabilities**
   - Malicious file upload (polyglots, path traversal)
   - Content-type validation bypass
   - Stored XSS via uploaded content

8. **SSRF Testing**
   - Webhook URL validation
   - Knowledge Mound URL fetching
   - OAuth redirect manipulation

---

## Environment Details

### Test Environment

| Property | Value |
|----------|-------|
| Environment | Staging (isolated from production) |
| Base URL | `https://staging.aragora.example.com` |
| API Version | v1 (current) |
| Database | PostgreSQL 15 |
| Runtime | Python 3.11+ |

### Test Credentials (Provided)

| Role | Purpose | Permissions |
|------|---------|-------------|
| `pentest-admin` | Admin role testing | Full admin access |
| `pentest-user` | Standard user testing | Basic read/write |
| `pentest-readonly` | Reader role testing | Read-only access |
| `pentest-tenant-a` | Tenant A user | Tenant A resources |
| `pentest-tenant-b` | Tenant B user | Tenant B resources |

---

## Deliverables Required

### During Testing
- Daily status updates on critical findings
- Immediate notification (< 4 hours) for P0 vulnerabilities

### Final Report
1. **Executive Summary** - Business risk overview
2. **Methodology** - Testing approach used
3. **Findings** - Categorized by severity (Critical/High/Medium/Low/Info)
4. **Evidence** - Screenshots, request/response pairs, PoC code
5. **Remediation** - Specific fix recommendations
6. **Retest Results** - Verification of fixes (if retest included)

### Severity Definitions

| Severity | CVSS | Example |
|----------|------|---------|
| Critical | 9.0-10.0 | RCE, auth bypass, data breach |
| High | 7.0-8.9 | Privilege escalation, SQLi |
| Medium | 4.0-6.9 | XSS, CSRF, info disclosure |
| Low | 0.1-3.9 | Missing headers, verbose errors |
| Info | 0.0 | Best practice recommendations |

---

## Timeline & Logistics

### Proposed Schedule

| Phase | Duration | Activities |
|-------|----------|------------|
| Kickoff | 1 day | Scope review, credential exchange |
| Testing | 5-7 days | Active penetration testing |
| Reporting | 2-3 days | Report preparation |
| Remediation | 1-2 weeks | Fix critical/high findings |
| Retest | 1-2 days | Verify fixes |

### Points of Contact

| Role | Name | Contact |
|------|------|---------|
| Security Lead | [TBD] | security@aragora.io |
| Technical POC | [TBD] | devops@aragora.io |
| Emergency Contact | [TBD] | [Phone TBD] |

### Rules of Engagement

1. Testing hours: Business hours preferred, 24/7 allowed for staging
2. Rate limits: Stay under 100 requests/second to avoid infrastructure alerts
3. Data handling: No exfiltration of real customer data (test data only)
4. Communication: Use encrypted channels (Signal, encrypted email)
5. Incident response: Stop testing if production impact detected

---

## Vendor Selection Criteria

### Required Qualifications
- [ ] CREST/OSCP/CEH certified testers
- [ ] SOC 2 experience (Type I or Type II audits)
- [ ] API security specialization
- [ ] Multi-tenant SaaS experience
- [ ] NDA and liability insurance

### Preferred Experience
- [ ] Previous engagements with AI/ML platforms
- [ ] WebSocket security testing
- [ ] OAuth/OIDC security assessments
- [ ] Python web application experience

---

## Appendix A: API Endpoint Summary

The full API surface is documented in `docs/API_REFERENCE.md`. Key endpoint categories:

- **Auth**: 12+ endpoints (`/api/v1/auth/*`)
- **Debates**: 20+ endpoints (`/api/v1/debates/*`)
- **Agents**: 15+ endpoints (`/api/v1/agents/*`)
- **Knowledge**: 25+ endpoints (`/api/v1/knowledge/*`)
- **Admin**: 30+ endpoints (`/api/v1/admin/*`)
- **Connectors**: 40+ endpoints (`/api/v1/connectors/*`)
- **WebSocket**: 15 event streams (`/ws/*`)

Total: ~275 HTTP endpoints + 15 WebSocket streams

---

## Appendix B: Security Controls in Place

| Control | Implementation | Location |
|---------|----------------|----------|
| Rate Limiting | Token bucket per tenant/IP | `aragora/resilience.py` |
| Circuit Breaker | Fail-fast on dependency issues | `aragora/resilience.py` |
| RBAC v2 | 50+ permissions, role hierarchy | `aragora/rbac/` |
| Audit Logging | All security events logged | `aragora/audit/` |
| Input Validation | Pydantic models | All handlers |
| SQL Injection | Parameterized queries | All database access |
| XSS Protection | Content-Type headers, CSP | Response middleware |
| CSRF Protection | Token-based for web UI | Form handlers |

---

## Appendix C: Known Limitations

These items are documented and accepted risks:

1. **MD5 for cache keys** - Used with `usedforsecurity=False`, not for cryptographic purposes
2. **0.0.0.0 binding** - Expected in containerized deployments, network policies enforce access
3. **XML parsing** - Internal GraphML export only, no external XML input

---

## Document Approval

| Role | Name | Date | Signature |
|------|------|------|-----------|
| Security Lead | | | |
| Engineering Lead | | | |
| Compliance Officer | | | |
