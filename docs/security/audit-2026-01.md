# Security Audit - January 2026

## Executive Summary

This document records the security audit findings for the Aragora codebase conducted in January 2026.

**Audit Status**: PASS (with documented exceptions)

## 1. Code Pattern Audit

### 1.1 eval/exec/__import__ Patterns

**Total instances found**: 68

**Categories**:

| Category | Count | Status |
|----------|-------|--------|
| subprocess_exec (safe) | 42 | SAFE |
| Sandboxed eval (proofs.py) | 8 | SAFE |
| ORM/serialization | 12 | SAFE |
| Plugin loading | 6 | SAFE |

**Details**:

#### Subprocess Execution (42 instances)
All uses of `asyncio.create_subprocess_exec()` for:
- Git operations (clone, pull, status)
- Python subprocess execution
- External tool invocation

These are safe as they use argument lists, not shell strings.

#### Sandboxed Evaluation (8 instances)
Location: `aragora/verification/proofs.py`

The proof verification system uses a sandboxed eval with:
- `SAFE_BUILTINS` whitelist (len, str, int, float, bool, list, dict, set, tuple, range, enumerate, zip, map, filter, sorted, reversed, sum, min, max, abs, round, all, any)
- No access to `__import__`, `open`, `exec`, `eval`, `compile`
- Restricted globals namespace

**Risk**: LOW - properly sandboxed

#### ORM/Serialization (12 instances)
Standard SQLAlchemy patterns and JSON serialization.

**Risk**: NONE - framework-managed

#### Plugin Loading (6 instances)
Location: `aragora/plugins/loader.py`

Uses `importlib` for dynamic module loading with:
- Whitelist of allowed plugin paths
- Signature verification for plugins
- Sandboxed execution environment

**Risk**: LOW - controlled loading paths

### 1.2 SQL Injection Patterns

**Bandit findings**: 63 B608 warnings

**Analysis**: All flagged patterns are SQLAlchemy ORM queries using:
- Parameterized queries
- Column filters (`.where()`, `.filter()`)
- No raw string interpolation in SQL

**Risk**: NONE - false positives from static analysis

## 2. Authentication Module Audit

### 2.1 Logging Review

**Files audited**:
- `aragora/auth/lockout.py`
- `aragora/auth/saml.py`
- `aragora/auth/oidc.py`
- `aragora/server/handlers/auth/`

**Findings**:
- No passwords logged
- No full tokens logged
- API keys logged only as truncated hashes (first 8 chars)
- Audit trail captures security events without sensitive data

**Risk**: NONE

### 2.2 Token Handling

- Tokens stored in secure HTTP-only cookies
- CSRF protection enabled
- Session invalidation on logout
- Token rotation on privilege escalation

## 3. Dependency Vulnerabilities

### Current Status (January 2026)

| Package | Version | CVE | Fix | Status |
|---------|---------|-----|-----|--------|
| distributed | 2026.1.1 | GHSA-c336-7962-wfj2 | 2026.1.1 | ✅ FIXED |
| biopython | 1.86 | GHSA-x3vf-39hj-gxr4 | N/A | ✅ REMOVED |
| keras | 3.12.0 | GHSA-xfhx-r7ww-5995 | 3.13.1 | ✅ REMOVED |

**All known CVEs resolved as of 2026-01-18.**

### Resolution Details

#### biopython (GHSA-x3vf-39hj-gxr4)
- **Resolution**: Package removed
- **Reason**: Not used in codebase (orphaned dependency)
- **Date**: 2026-01-18

#### keras/tensorflow (GHSA-xfhx-r7ww-5995)
- **Resolution**: Packages removed (keras, tensorflow, tf_keras)
- **Reason**: Not used in codebase (orphaned dependencies)
- **Date**: 2026-01-18

## 4. Infrastructure Security

### 4.1 Network Security
- All API endpoints require authentication
- CORS configured with explicit origin whitelist
- Rate limiting enabled (100 req/min default)
- TLS 1.3 required for production

### 4.2 Secret Management
- Secrets loaded from environment variables
- No hardcoded credentials in codebase
- API keys rotated quarterly

## 5. Recommendations

### Immediate (Sprint 5)
- [x] Upgrade distributed to 2026.1.1
- [x] Document biopython risk acceptance
- [x] Document keras mitigation

### Short-term (Q1 2026)
- [ ] Upgrade to Python 3.11+ to fix keras CVE
- [ ] Add automated pip-audit to CI/CD
- [ ] Implement SAST scanning (Bandit) in CI/CD

### Long-term (Q2 2026)
- [ ] External penetration test
- [ ] SOC 2 Type II preparation
- [ ] Security bug bounty program

## 6. Approval

| Role | Name | Date |
|------|------|------|
| Security Lead | [Pending] | |
| Engineering Lead | [Pending] | |
| CTO | [Pending] | |

---

*Last updated: 2026-01-18*
