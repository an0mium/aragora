# Penetration Test Tracking

This document defines the process for engaging a penetration testing vendor,
tracking findings, and gating CI/CD on open findings past SLA.

## Vendor Engagement Workflow

1. **Scope definition** -- Define target endpoints, environments, and rules of
   engagement.  See `PENTEST_SCOPE.md` for the current scope document.
2. **Vendor selection** -- Evaluate vendors against `PENTEST_VENDORS.md` criteria.
3. **Kickoff** -- Provide vendor with a staging environment, API keys (scoped), and
   documentation links.
4. **Testing window** -- Typically 2--4 weeks.  Vendor reports findings via a shared
   portal or encrypted channel.
5. **Triage** -- Security team reviews each finding, assigns severity, and enters it
   into `pentest_findings.json`.
6. **Remediation** -- Engineering teams fix findings within SLA (see below).
7. **Retest** -- Vendor confirms fix.  Finding status set to `remediated`.
8. **Sign-off** -- Final report archived; CI gate updated.

## Finding Severity and SLA

| Severity | Remediation SLA | CI Gate |
|----------|-----------------|---------|
| CRITICAL | 48 hours        | Blocks deploy |
| HIGH     | 1 week          | Blocks deploy |
| MEDIUM   | 2 weeks         | Warning |
| LOW      | 30 days         | Informational |

## Finding Lifecycle

```
reported -> triaged -> in_progress -> remediated -> verified -> closed
                   \-> accepted_risk (with justification)
                   \-> false_positive (with evidence)
```

## Finding Record Format

Findings are stored in `docs/security/pentest_findings.json` as an array of
objects.  Each object has:

| Field          | Type   | Description                                    |
|----------------|--------|------------------------------------------------|
| `id`           | string | Unique finding ID (e.g. `PT-2026-001`)         |
| `title`        | string | Short description                              |
| `severity`     | string | `CRITICAL`, `HIGH`, `MEDIUM`, or `LOW`         |
| `status`       | string | Lifecycle status (see above)                   |
| `reported_date`| string | ISO-8601 date the finding was reported          |
| `sla_deadline` | string | ISO-8601 date by which remediation is required  |
| `assignee`     | string | Team or individual responsible                  |
| `description`  | string | Full finding description                        |
| `remediation`  | string | Steps taken to fix (filled after remediation)   |
| `jira_ticket`  | string | Link to the internal tracking ticket            |

## CI Gate

The script `scripts/check_pentest_findings.py` runs in CI and:

1. Reads `docs/security/pentest_findings.json`.
2. Checks each CRITICAL or HIGH finding against its `sla_deadline`.
3. **Fails the build** if any CRITICAL or HIGH finding is open past its SLA.
4. Prints a summary table for visibility.

### Running locally

```bash
python scripts/check_pentest_findings.py
```

Exit codes:
- `0` -- All findings within SLA (or no findings).
- `1` -- One or more CRITICAL/HIGH findings are past SLA.

## Retest Cadence

- **Quarterly** external pentest (full scope).
- **Continuous** automated scanning via DAST tooling integrated into CI.
- **Ad-hoc** retests after major architectural changes.

## Escalation

If a CRITICAL finding cannot be remediated within 48 hours:

1. Notify the security lead and CTO immediately.
2. Implement a compensating control (WAF rule, feature flag, etc.).
3. Document the accepted risk in the finding record.
4. Schedule remediation for the next sprint.
