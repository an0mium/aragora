# Aragora Penetration Testing Requirements

## Overview

This document outlines the requirements for a third-party penetration test of the Aragora platform to validate security controls for enterprise deployment.

## Scope

### In-Scope Systems

1. **REST API** (461 endpoints)
   - Authentication endpoints (`/api/auth/*`)
   - Debate management (`/api/debates/*`)
   - Knowledge Mound (`/api/knowledge/*`)
   - Workflow engine (`/api/workflows/*`)
   - Admin endpoints (`/api/admin/*`)
   - Webhook management (`/api/webhooks/*`)

2. **WebSocket Connections** (22 streams)
   - Real-time debate streaming
   - Voice/TTS integration
   - Event subscriptions

3. **Authentication & Authorization**
   - JWT token handling
   - OAuth 2.0 flows (Google, GitHub, Microsoft, OKTA, SAML)
   - MFA (TOTP, SMS, Email)
   - API key authentication
   - RBAC permission system (50+ permissions)

4. **Data Storage**
   - PostgreSQL database
   - Redis cache
   - File storage (backups, exports)
   - Encrypted credential storage (AES-256-GCM)

5. **External Integrations**
   - Slack OAuth and webhooks
   - Microsoft Teams Bot Framework
   - GitHub webhooks
   - Stripe billing webhooks

### Out-of-Scope

- Third-party AI provider APIs (OpenAI, Anthropic, etc.)
- Client-side browser security (CSP enforcement only)
- Physical infrastructure (AWS/cloud provider responsibility)
- DDoS protection (handled by infrastructure layer)

## Testing Objectives

### Priority 1: Critical Security

1. **Authentication Bypass**
   - Attempt to bypass JWT validation
   - Test token expiration and refresh flows
   - Verify MFA enforcement
   - Test API key privilege escalation

2. **Authorization Flaws**
   - RBAC permission bypass
   - Horizontal privilege escalation (tenant isolation)
   - Vertical privilege escalation (user â†’ admin)
   - Resource-level access control violations

3. **Injection Vulnerabilities**
   - SQL injection across all database queries
   - NoSQL injection (Redis commands)
   - Command injection (agent prompts)
   - SSTI (template injection)

4. **Sensitive Data Exposure**
   - API key leakage in responses
   - PII exposure in logs
   - Credential exposure in error messages
   - Encryption key handling

### Priority 2: High Security

5. **SSRF & Request Forgery**
   - Webhook URL validation
   - OAuth redirect validation
   - Internal service access prevention

6. **Webhook Security**
   - Signature verification bypass
   - Replay attacks
   - Event spoofing

7. **Session Management**
   - Session fixation
   - Session hijacking
   - Concurrent session handling
   - Logout effectiveness

8. **Rate Limiting**
   - Authentication brute force
   - API endpoint abuse
   - Resource exhaustion

### Priority 3: Medium Security

9. **Business Logic**
   - Debate manipulation
   - Vote stuffing/manipulation
   - Workflow approval bypass
   - Cost/billing manipulation

10. **Information Disclosure**
    - Error message verbosity
    - Stack trace exposure
    - Internal path disclosure
    - Version information leakage

11. **Cryptographic Issues**
    - Weak encryption algorithms
    - Predictable tokens
    - Timing attacks

## Test Methodology

### Approach

- **Gray-box testing**: Provide tester accounts with various permission levels
- **API-first testing**: Focus on REST and WebSocket interfaces
- **Manual and automated**: Combination of automated scanning and manual testing

### Test Accounts

Provide test accounts with the following roles:
1. Unauthenticated (public endpoints only)
2. Free tier user (limited permissions)
3. Pro tier user (standard permissions)
4. Enterprise admin (full permissions)
5. System admin (global access)

### Test Environment

- Staging environment mirror of production
- Isolated database with synthetic data
- All integrations enabled (Slack, Teams, GitHub)
- Full audit logging enabled

## Deliverables Required

### From Vendor

1. **Executive Summary**
   - Risk assessment overview
   - Critical findings summary
   - Compliance implications (SOC 2, GDPR)

2. **Technical Report**
   - Detailed vulnerability descriptions
   - CVSS scores for each finding
   - Proof-of-concept demonstrations
   - Affected endpoints/components
   - Remediation recommendations

3. **Compliance Evidence**
   - Attestation letter
   - Methodology documentation
   - Test coverage metrics
   - Re-test verification

### Timeline

- **Duration**: 2-3 weeks active testing
- **Report delivery**: Within 5 business days of testing completion
- **Re-testing**: Within 2 weeks of remediation

## Compliance Requirements

### SOC 2 Type II

This penetration test supports the following SOC 2 trust service criteria:
- CC6.6: Logical access controls
- CC6.7: Authentication and authorization
- CC7.2: Security event monitoring

### GDPR

Test coverage for:
- Data minimization compliance
- Right to erasure functionality
- Cross-border data handling

## Contact Information

### Aragora Security Team

- Security Lead: [contact]
- Engineering Lead: [contact]
- DevOps Lead: [contact]

### Emergency Contact

For critical findings discovered during testing:
- Immediate notification required for severity >= 9.0 CVSS
- 24-hour notification for severity >= 7.0 CVSS

## Recommended Vendors

Based on expertise in API security and enterprise platforms:

1. **Trail of Bits**
   - Expertise: API security, cryptography
   - Typical engagement: $30-50K

2. **Cure53**
   - Expertise: Web application security
   - Typical engagement: $20-40K

3. **Bishop Fox**
   - Expertise: Enterprise application testing
   - Typical engagement: $40-60K

4. **NCC Group**
   - Expertise: Full-stack security assessment
   - Typical engagement: $50-80K

## Appendix

### Existing Security Controls

| Control | Implementation |
|---------|---------------|
| Input validation | Pydantic schemas, regex patterns |
| Output encoding | JSON serialization, HTML escaping |
| Authentication | JWT with RS256, bcrypt passwords |
| Authorization | RBAC with 50+ fine-grained permissions |
| Encryption | AES-256-GCM for secrets, TLS 1.3 in transit |
| Rate limiting | Token bucket per-user, per-endpoint |
| Audit logging | Immutable audit trail with hashing |
| CORS | Strict origin validation |
| CSP | Restrictive content security policy |
| Session management | Secure cookies, short expiration |

### Previous Security Audits

- Internal code review: Completed January 2026
- Dependency audit: Automated via Dependabot
- SAST scanning: Integrated in CI/CD

### API Documentation

- OpenAPI 3.1 specification available
- 461 documented endpoints
- Request/response schemas
- Authentication requirements per endpoint
