# Aragora External Penetration Test -- Scope Document

**Version:** 3.0.0
**Classification:** CONFIDENTIAL -- Authorized Recipients Only
**Date:** February 2026
**Prepared by:** Aragora Security Team
**SOC 2 Control:** CC7.1 (Security Testing)
**Platform:** Aragora Decision Integrity Platform

---

## 1. Executive Summary

Aragora is an enterprise multi-agent Decision Integrity Platform that orchestrates 43 AI
agent types to adversarially vet decisions against organizational knowledge, delivering
audit-ready decision receipts to any channel (web, Slack, Teams, email, Telegram, WhatsApp,
Discord, webhooks). The platform is positioned for SMB and enterprise customers with strict
compliance requirements (SOC 2, GDPR, HIPAA, EU AI Act).

This document defines the scope for an external gray-box penetration test of the Aragora
platform. The engagement covers the full HTTP REST API surface (2,775 documented paths across
240+ handler modules), WebSocket streaming endpoints (8 distinct WebSocket servers), SSO
authentication (OIDC, SAML 2.0, OAuth 2.0), multi-tenant data isolation, RBAC authorization,
agent execution sandboxing, and the OpenClaw computer-use gateway.

### Engagement Objectives

1. Validate that authentication and authorization controls prevent unauthorized access across
   all API surface areas, including the WebSocket upgrade path.
2. Confirm multi-tenant data isolation prevents cross-tenant data leakage under adversarial
   conditions.
3. Assess the platform's resistance to injection attacks (SQL, prompt, command, XML, LDAP)
   across all input vectors.
4. Verify that cryptographic controls (AES-256-GCM encryption, JWT signing, key rotation)
   are correctly implemented and resist known attack patterns.
5. Validate that prior audit findings (13 OpenClaw findings, February 2026) have been
   effectively remediated.
6. Assess AI-specific attack vectors including prompt injection through debate inputs,
   agent credential leakage, and model output manipulation.

### Engagement Parameters

| Parameter | Value |
|-----------|-------|
| Testing approach | Gray-box (OpenAPI spec, architecture docs, test credentials provided) |
| Duration | 3 weeks active testing + 1 week reporting |
| Frequency | Annual full assessment; quarterly automated scans |
| Rules of engagement | No volumetric DDoS; no production data modification; staging only |
| Communication | Daily standups via secure channel; immediate notification for Critical findings |
| Point of contact | Security Lead (see Section 9) |

---

## 2. In-Scope Systems

### 2.1 HTTP API Surface

The Aragora API is a monolithic HTTP server exposing 2,775 documented paths via OpenAPI 3.0
specification (see `docs/api/openapi.json`). Handlers are organized across 240+ modules in
`aragora/server/handlers/`.

| Component | Source Location | Details |
|-----------|----------------|---------|
| Unified Server | `aragora/server/unified_server.py` | Main entry point, ThreadingHTTPServer + aiohttp |
| Handler Registry | `aragora/server/handler_registry.py` | Dynamic handler routing and registration |
| Request Lifecycle | `aragora/server/request_lifecycle.py` | Request parsing, body deserialization, content-length enforcement |
| Request Utilities | `aragora/server/request_utils.py` | `MAX_JSON_CONTENT_LENGTH` enforcement, JSON body parsing |
| Response Utilities | `aragora/server/response_utils.py` | Response serialization, error message formatting |
| OpenAPI Spec | `docs/api/openapi.json` | 2,775 paths, machine-readable |

**Key API categories and base paths:**

| Category | Path Pattern | Priority | Reason |
|----------|-------------|----------|--------|
| Authentication | `/api/v2/auth/*`, `/api/auth/*` | Critical | Controls access to entire platform |
| Admin / System | `/api/v2/admin/*` | Critical | System configuration, user management |
| Billing / Payments | `/api/v2/billing/*`, `/api/v2/payments/*` | Critical | Financial data, payment tokens |
| SCIM Provisioning | `/scim/v2/Users/*`, `/scim/v2/Groups/*` | Critical | Identity provisioning (RFC 7644) |
| API Key Management | `/api/v2/auth/api-keys/*` | Critical | Long-lived credential management |
| Debates | `/api/v2/debates/*` | High | Core business logic, multi-agent orchestration |
| Users / Tenancy | `/api/v2/users/*`, `/api/v2/workspaces/*` | High | User PII, tenant boundaries |
| OpenClaw Gateway | `/api/gateway/openclaw/*` | High | Computer-use agent actions, credential store |
| Knowledge Mound | `/api/v2/knowledge/*` | Medium | Organizational knowledge, 34 adapters |
| Workflows | `/api/v2/workflows/*` | Medium | DAG-based automation execution |
| Pipeline | `/api/v2/pipeline/*` | Medium | Idea-to-execution 4-stage pipeline |
| Privacy / Consent | `/api/v2/privacy/*` | Medium | GDPR consent, data deletion, retention |
| Compliance | `/api/v2/compliance/*` | Medium | Compliance checks, EU AI Act artifacts |
| Gauntlet | `/api/v2/gauntlet/*` | Medium | Adversarial validation runs |
| File Upload | `/api/v2/documents/*`, `/api/v2/upload/*` | Medium | Document and media upload |
| Health / Status | `/healthz`, `/readyz`, `/api/health/*` | Low | Liveness and readiness probes |

**Auth-exempt paths** (defined in `aragora/server/auth_checks.py` -- verify none leak sensitive data):
`/healthz`, `/readyz`, `/api/health/*`, `/api/auth/oauth/providers`,
`/api/openapi*`, `/api/docs/*`, `/api/insights/recent`, `/api/flips/recent`,
`/api/evidence`, `/api/evidence/statistics`, `/api/verification/status`.

### 2.2 WebSocket Streaming Endpoints

The platform exposes 8 distinct WebSocket server types. All require authentication validation
on the WebSocket upgrade handshake.

| WebSocket Server | Source Location | Path | Purpose |
|------------------|----------------|------|---------|
| Debate Stream | `aragora/server/stream/debate_stream_server.py` | `/ws/debate/{id}` | Real-time debate events (190+ event types) |
| Oracle Stream | `aragora/server/stream/oracle_stream.py` | `/ws/oracle` | Shoggoth Oracle real-time Q&A with streaming TTS |
| Voice Stream | `aragora/server/stream/voice_stream.py` | `/ws/voice/{debate_id}` | Bidirectional voice I/O (STT via Whisper, TTS) |
| Control Plane Stream | `aragora/server/stream/control_plane_stream.py` | `/ws/control-plane` | Agent status, task lifecycle, health events |
| Gateway Stream | `aragora/server/stream/gateway_stream.py` | `/ws/gateway` | External agent response chunks, capability events |
| Pipeline Stream | `aragora/server/stream/pipeline_stream.py` | `/ws/pipeline/{id}` | Idea-to-execution pipeline progress |
| Workflow Stream | `aragora/server/stream/workflow_stream.py` | `/ws/workflow/{id}` | Workflow DAG execution step events |
| Autonomous Stream | `aragora/server/stream/autonomous_stream.py` | `/ws/autonomous` | Autonomous agent event feeds |

**Oracle Stream protocol detail** (highest complexity):
- Client sends: `{"type": "ask", "question": "...", "mode": "consult|divine|commune"}`,
  `{"type": "interim", "text": "..."}`, `{"type": "stop"}`, `{"type": "ping"}`
- Server sends: JSON text frames (token streaming, phase progression) and binary frames
  (1-byte phase tag + raw MP3 audio chunks)
- Phase tags: `0x00`=reflex, `0x01`=deep, `0x02`=tentacle, `0x03`=synthesis

**Testing focus:** Authentication on WebSocket upgrade, message injection, event subscription
authorization, connection exhaustion, resume token replay (`aragora/server/stream/resume_token.py`),
cross-debate event leakage, binary frame parsing abuse.

### 2.3 Authentication and Session Management

| Component | Source Location | Details |
|-----------|----------------|---------|
| OIDC Provider | `aragora/auth/oidc.py` | Azure AD, Okta, Google Workspace, Auth0, Keycloak, generic OIDC |
| SAML 2.0 Provider | `aragora/auth/saml.py` | Enterprise SSO via python3-saml, XML signature validation |
| SSO Abstraction | `aragora/auth/sso.py` | Unified SSO interface (SAML, OIDC, Azure AD, Okta, Google, GitHub) |
| MFA Enforcement | `aragora/auth/mfa_enforcement.py` | TOTP/HOTP MFA for admin roles (SOC 2 CC5-01) |
| Token Rotation | `aragora/auth/token_rotation.py` | Max-use, time-based, IP-change, suspicious activity rotation |
| Account Lockout | `aragora/auth/lockout.py` | Failed login lockout policy |
| Session Monitor | `aragora/auth/session_monitor.py` | Active session tracking and management |
| Impersonation | `aragora/auth/impersonation.py` | Admin impersonation with audit trail |
| Teams SSO | `aragora/auth/teams_sso.py` | Microsoft Teams SSO integration |
| SCIM 2.0 Server | `aragora/auth/scim/server.py` | RFC 7644 user/group provisioning (12 endpoints) |
| Auth Middleware | `aragora/server/middleware/auth.py` | HTTP authentication middleware |
| User Auth Middleware | `aragora/server/middleware/user_auth.py` | User-level auth middleware |
| MFA Middleware | `aragora/server/middleware/mfa.py` | Per-request MFA enforcement |
| Token Revocation | `aragora/server/middleware/token_revocation.py` | Revoked token blacklist checking |
| Impersonation MW | `aragora/server/middleware/impersonation.py` | Impersonation request validation |
| Auth Handlers | `aragora/server/handlers/auth/` | Login, signup, API keys, MFA, password, SSO, sessions |
| OAuth Handlers | `aragora/server/handlers/_oauth_impl.py` | OAuth flow implementation |

**MFA-required roles** (hardcoded in `mfa_enforcement.py`): `admin`, `owner`, `superadmin`,
`super_admin`, `org_admin`, `workspace_admin`, `security_admin`, `compliance_officer`.

**MFA-exempt paths** (verify no sensitive operations bypass MFA): `/health*`, `/ready`,
`/metrics`, `/api/docs`, `/openapi.json`, `/api/auth/login`, `/api/auth/register`,
`/api/auth/callback`, `/api/auth/refresh`, `/api/auth/mfa/verify`, `/api/auth/mfa/setup`,
`/api/auth/sso/*`, `/api/auth/oauth/*`, `/scim/v2/*`.

**Testing focus:**
- JWT algorithm confusion (`alg: none`, `HS256` vs `RS256` swapping)
- Token expiration bypass and clock skew exploitation
- OIDC `state` parameter fixation and replay
- OIDC redirect URI manipulation (`redirect_uri` open redirect)
- SAML XML signature wrapping attacks (XSW1-XSW8)
- SAML response replay and assertion consumer service (ACS) hijacking
- SAML XML external entity (XXE) injection -- note: `defusedxml.ElementTree` is used
- MFA bypass (step-up auth flow manipulation, race conditions)
- MFA enrollment phishing (verify enrollment requires prior authentication)
- Session fixation and concurrent session handling
- Token rotation race conditions (use-after-revoke window)
- Impersonation privilege escalation (non-admin impersonation attempt)
- SCIM provisioning authentication bypass (bearer token validation)
- SCIM filter injection (verify `SCIMFilterParser` prevents SQL/LDAP injection)
- Account lockout bypass and lockout enumeration
- Password reset flow manipulation

### 2.4 Authorization (RBAC v2 + ABAC)

| Component | Source Location | Details |
|-----------|----------------|---------|
| RBAC Models | `aragora/rbac/models.py` | Permission, Role, RoleAssignment, APIKeyScope, AuthorizationContext |
| Permission Checker | `aragora/rbac/checker.py` | Permission resolution with caching |
| RBAC Middleware | `aragora/rbac/middleware.py` | HTTP route permission enforcement (`DEFAULT_ROUTE_PERMISSIONS`) |
| RBAC Decorators | `aragora/rbac/decorators.py` | `@require_permission`, `@require_role` |
| Role Hierarchy | `aragora/rbac/hierarchy.py` | Parent role inheritance |
| Delegation | `aragora/rbac/delegation.py` | Permission delegation between users |
| Emergency Access | `aragora/rbac/emergency.py` | Break-glass access mechanism |
| ABAC Conditions | `aragora/rbac/conditions.py` | Attribute-based access control conditions |
| ABAC Middleware | `aragora/server/middleware/abac.py` | Request-level ABAC enforcement |
| Ownership | `aragora/rbac/ownership.py` | Resource ownership checks |
| RBAC Cache | `aragora/rbac/cache.py` | Permission decision caching |
| RBAC Audit | `aragora/rbac/audit.py` | Authorization audit logging |
| Resource Permissions | `aragora/rbac/resource_permissions.py` | Per-resource permission definitions |
| Quotas | `aragora/rbac/quotas.py` | Role-based resource quotas |
| Profiles | `aragora/rbac/profiles.py` | Permission profiles |
| Approvals | `aragora/rbac/approvals.py` | Approval workflow for sensitive operations |
| Enforcer | `aragora/rbac/enforcer.py` | Unified RBAC enforcement engine |

**Permission model:** 50+ permissions across 14+ resource types (`debate`, `agent`, `workflow`,
`document`, `memory`, `culture`, `knowledge_node`, `audit_session`, `audit_finding`,
`training_job`, `specialist_model`, `workspace`, `organization`, `billing`, `api_key`).
Permission keys use `resource.action` format (e.g., `debates.create`, `admin.system_config`).
Wildcard support: `resource.*` and `*`.

**7 default roles:** viewer, member, editor, moderator, admin, owner, superadmin (hierarchical
inheritance via `aragora/rbac/hierarchy.py`).

**4 scope levels:** global, organization, workspace, resource.

**Testing focus:**
- Horizontal privilege escalation (IDOR across tenants/workspaces)
- Vertical privilege escalation (viewer to admin role manipulation)
- Permission cache poisoning (stale cache grants revoked permissions)
- Wildcard permission abuse (`*` or `resource.*` unintended grants)
- Delegation chain escalation (delegated permission exceeds delegator's scope)
- Break-glass bypass without proper audit trail
- `APIKeyScope` with empty permissions -- verify behavior (documented as full access)
- ABAC condition bypass (attribute manipulation in request context)
- Approval workflow bypass (direct API call skipping approval gate)
- Quota bypass between roles/tiers

### 2.5 Multi-Tenancy Isolation

| Component | Source Location | Details |
|-----------|----------------|---------|
| Tenant Isolation | `aragora/tenancy/isolation.py` | 4 isolation levels: none, soft, strict, complete |
| Tenant Context | `aragora/tenancy/context.py` | ContextVar-based async-safe tenant propagation |
| Tenant Provisioning | `aragora/tenancy/provisioning.py` | New tenant setup and configuration |
| Tenant Quotas | `aragora/tenancy/quotas.py` | Per-tenant resource quotas and usage tracking |
| Quota Persistence | `aragora/tenancy/quota_persistence.py` | Quota state persistence |
| Tenant Limits | `aragora/tenancy/limits.py` | Hard limits per tenant |
| Tenant Isolation MW | `aragora/server/middleware/tenant_isolation.py` | Fail-closed membership checks |
| Tenancy MW | `aragora/server/middleware/tenancy.py` | Tenant context propagation from request |
| WS Tenant Filter | `aragora/server/stream/tenant_filter.py` | WebSocket event tenant filtering |
| Tier Enforcement MW | `aragora/server/middleware/tier_enforcement.py` | Plan tier feature gating |

**Testing focus:**
- Cross-tenant data access via direct ID manipulation
- Tenant context spoofing (header injection, token claim manipulation)
- Quota bypass between tenants
- Tenant ID injection in API requests bypassing middleware
- WebSocket event leakage across tenants
- Shared resource contamination in `soft` isolation mode
- ContextVar isolation under concurrent async requests (race condition)

### 2.6 OpenClaw Agent Gateway

| Component | Source Location | Details |
|-----------|----------------|---------|
| Standalone Server | `aragora/compat/openclaw/standalone.py` | Minimal HTTP server (independent deployment) |
| Session Orchestrator | `aragora/server/handlers/openclaw/orchestrator.py` | Session and action management |
| Credential Store | `aragora/server/handlers/openclaw/store.py` | In-memory + SQLite persistent store |
| Credential Handlers | `aragora/server/handlers/openclaw/credentials.py` | Credential CRUD with AES-256-GCM |
| Policy Handlers | `aragora/server/handlers/openclaw/policies.py` | Policy management and health |
| Input Validation | `aragora/server/handlers/openclaw/validation.py` | Regex whitelisting, shell metachar blocking |
| Skill Scanner | `aragora/compat/openclaw/skill_scanner.py` | Malware pattern detection in skills |
| Computer Use Bridge | `aragora/compat/openclaw/computer_use_bridge.py` | Browser action bridging |
| Sandbox | `aragora/compat/openclaw/openclaw_sandbox.py` | Workspace scoping, resource limits, path blocking |

**Prior audit:** See `docs/security/OPENCLAW_AUDIT.md` for 13 findings from the February 2026
OWASP Top 10 audit. All findings reported as remediated -- retest required.

**Testing focus:** Retest all 13 prior findings (especially F01 auth bypass, F02 credential
encryption fallback, F07 NavigateAction SSRF). Additionally: command injection via agent
actions, credential exfiltration, sandbox escape, skill code execution, policy bypass.

### 2.7 File Upload Handling

| Component | Source Location | Details |
|-----------|----------------|---------|
| File Validation | `aragora/server/handlers/utils/file_validation.py` | Size limits, MIME whitelist, path traversal prevention |
| Smart Upload | `aragora/server/handlers/features/smart_upload.py` | Intelligent upload processing |
| Document Upload | `aragora/server/handlers/features/documents.py` | Document upload and batch processing |
| Cloud Storage | `aragora/server/handlers/cloud_storage.py` | Cloud storage file operations |
| Transcription Upload | `aragora/server/handlers/transcription.py` | Audio/video upload for transcription |

**Configuration:** `MAX_CONTENT_LENGTH = 100MB` (unified server), `MAX_MULTIPART_PARTS = 10`,
upload rate limits: 5/minute, 30/hour per user.

**Testing focus:** Path traversal in filenames, MIME type spoofing, polyglot file uploads,
null byte injection, double extension bypass, zip bomb / decompression bomb, oversized
multipart boundary attacks, symlink following on disk storage.

### 2.8 Database Layer

| Component | Source Location | Details |
|-----------|----------------|---------|
| PostgreSQL Store | `aragora/storage/postgres_store.py` | Production database |
| Schema Manager | `aragora/storage/schema.py` | SQLite/PostgreSQL schema versioning and migrations |
| Redis HA | `aragora/storage/redis_ha.py` | High-availability Redis (sessions, cache, rate limits) |
| Repositories | `aragora/storage/repositories/` | Data access layer |

**Testing focus:** SQL injection via any endpoint backed by string-interpolated queries
(parameterized queries are standard -- verify no exceptions), migration injection,
connection string exposure, Redis command injection if user input reaches Redis commands.

### 2.9 Agent Execution and AI-Specific Vectors

| Component | Source Location | Details |
|-----------|----------------|---------|
| CLI Agents | `aragora/agents/cli_agents.py` | Claude, Codex, Gemini, Grok CLI wrappers |
| API Agents | `aragora/agents/api_agents/` | Anthropic, OpenAI, Mistral, Grok, OpenRouter API clients |
| Agent Fallback | `aragora/agents/fallback.py` | OpenRouter fallback on quota errors |
| Airlock Proxy | `aragora/agents/airlock.py` | Agent resilience proxy |
| Sandbox Executor | `aragora/sandbox/executor.py` | Docker-based code execution sandboxing |
| Sandbox Policies | `aragora/sandbox/policies.py` | Execution policies and restrictions |
| Sandbox Pool | `aragora/sandbox/pool.py` | Container pool management |

**Testing focus:**
- Prompt injection via debate question/context inputs reaching agent prompts
- Indirect prompt injection via uploaded documents consumed by agents
- Agent credential leakage in responses (API keys, tokens)
- API key exposure in error messages and stack traces
- Request smuggling through agent proxy (Airlock)
- Sandbox escape (container breakout, resource exhaustion, filesystem access)
- Model output manipulation affecting decision receipts

### 2.10 Event Streaming and Message Queues

| Component | Source Location | Details |
|-----------|----------------|---------|
| Kafka Consumer | `aragora/connectors/enterprise/streaming/kafka.py` | Apache Kafka event ingestion |
| RabbitMQ Consumer | `aragora/connectors/enterprise/streaming/rabbitmq.py` | RabbitMQ event ingestion |
| Event Dispatcher | `aragora/events/dispatcher.py` | Internal event routing |
| Dead Letter Queue | `aragora/events/dead_letter_queue.py` | Failed event handling |

**Testing focus:** Message injection, deserialization attacks, queue poisoning, consumer
credential exposure.

### 2.11 Privacy and Data Protection

| Component | Source Location | Details |
|-----------|----------------|---------|
| Anonymization | `aragora/privacy/anonymization.py` | HIPAA Safe Harbor de-identification (18 identifiers) |
| Consent | `aragora/privacy/consent.py` | GDPR consent management |
| Deletion | `aragora/privacy/deletion.py` | Right to erasure (GDPR Art. 17) |
| Retention | `aragora/privacy/retention.py` | Data retention policies |
| Data Classification | `aragora/privacy/classifier.py` | Automated PII classification |
| Privacy Isolation | `aragora/privacy/isolation.py` | Data isolation for privacy |

**Testing focus:** Data deletion completeness (verify no residual data after deletion request),
consent enforcement bypass, anonymization reversibility, PII leakage in logs/responses.

---

## 3. Out-of-Scope

### Excluded Systems

| System | Reason |
|--------|--------|
| Third-party AI providers (Anthropic, OpenAI, Mistral, xAI, Google, OpenRouter) | Covered by their own security programs |
| Payment processor (Stripe) | PCI DSS certified, separate vendor assessment |
| Email delivery (SendGrid/Postmark) | Separate vendor assessment |
| DNS / CDN (Cloudflare) | Separate infrastructure vendor |
| Monitoring stack (Prometheus, Grafana) | Internal-only, no external exposure |
| Cloud infrastructure (AWS/GCP IAM, VPC, security groups) | Separate infrastructure assessment |
| Mobile applications | No mobile client exists |

### Excluded Techniques

| Technique | Reason |
|-----------|--------|
| Volumetric DDoS | Risk of production impact; coordinate separately if needed |
| Physical security testing | Out of scope for application assessment |
| Social engineering | Separate engagement required |
| Supply chain attacks on dependencies | Covered by Dependabot and dependency scanning |
| Zero-day exploitation of OS/runtime | Separate vulnerability disclosure process |
| Source code review (SAST) | Provided as supplementary context only; findings should be exploitation-validated |

### Conditional Scope

| System | Condition |
|--------|-----------|
| Next.js frontend (`aragora/live/`) | In scope only if deployed to staging; focus on auth flows, CSRF, XSS |
| Chat connectors (Telegram, WhatsApp, Slack, Discord, Teams) | In scope if webhook endpoints are exposed to staging |
| Kafka/RabbitMQ connectors | In scope if message broker is available in staging |

---

## 4. Testing Methodology

### 4.1 Standards and Frameworks

| Framework | Application |
|-----------|-------------|
| OWASP Top 10 (2021) | Web application vulnerabilities |
| OWASP API Security Top 10 (2023) | API-specific vulnerabilities |
| OWASP Testing Guide v4.2 | Testing methodology reference |
| NIST SP 800-115 | Technical security testing guidance |
| CWE/SANS Top 25 | Software weakness classification |
| CVSS v3.1 | Vulnerability scoring |

### 4.2 Testing Categories

#### A. Authentication and Session Management (OWASP A07)

| Test | Description | Priority |
|------|-------------|----------|
| AUTH-01 | JWT token validation (algorithm, expiration, issuer, audience) | Critical |
| AUTH-02 | OIDC authorization code flow (state, nonce, PKCE, redirect_uri) | Critical |
| AUTH-03 | SAML response validation (signature wrapping, replay, XXE) | Critical |
| AUTH-04 | MFA bypass attempts (step-up flow, race conditions, code reuse) | Critical |
| AUTH-05 | Session fixation and session management | High |
| AUTH-06 | Token rotation and revocation effectiveness | High |
| AUTH-07 | Account lockout policy and bypass | High |
| AUTH-08 | SCIM bearer token authentication | High |
| AUTH-09 | API key authentication and scope enforcement | High |
| AUTH-10 | Impersonation flow privilege boundaries | High |
| AUTH-11 | Password reset flow manipulation | Medium |
| AUTH-12 | Concurrent session limits | Medium |

#### B. Authorization and Access Control (OWASP A01)

| Test | Description | Priority |
|------|-------------|----------|
| AUTHZ-01 | Horizontal privilege escalation (IDOR across users) | Critical |
| AUTHZ-02 | Vertical privilege escalation (role escalation to admin) | Critical |
| AUTHZ-03 | Cross-tenant data access | Critical |
| AUTHZ-04 | RBAC permission enforcement on all 2,775 API paths | High |
| AUTHZ-05 | Wildcard permission abuse | High |
| AUTHZ-06 | Permission delegation chain escalation | High |
| AUTHZ-07 | Break-glass access audit trail completeness | Medium |
| AUTHZ-08 | ABAC condition bypass | Medium |
| AUTHZ-09 | Approval workflow bypass | Medium |
| AUTHZ-10 | WebSocket event authorization (cross-debate, cross-tenant) | High |

#### C. Injection (OWASP A03)

| Test | Description | Priority |
|------|-------------|----------|
| INJ-01 | SQL injection across all database-backed endpoints | Critical |
| INJ-02 | Prompt injection via debate question and context inputs | Critical |
| INJ-03 | Command injection via OpenClaw agent actions | Critical |
| INJ-04 | XML injection in SAML responses (XXE, XSW) | High |
| INJ-05 | SCIM filter injection (LDAP/SQL) | High |
| INJ-06 | Server-side template injection (SSTI) | Medium |
| INJ-07 | Redis command injection | Medium |
| INJ-08 | Indirect prompt injection via uploaded documents | High |
| INJ-09 | WebSocket message injection | Medium |
| INJ-10 | Header injection (CRLF, host header) | Medium |

#### D. API Security (OWASP API Top 10)

| Test | Description | Priority |
|------|-------------|----------|
| API-01 | Broken Object Level Authorization (BOLA/IDOR) | Critical |
| API-02 | Broken Authentication (token validation gaps) | Critical |
| API-03 | Excessive Data Exposure (response filtering) | High |
| API-04 | Rate limiting effectiveness (per-IP, per-user, per-tenant, per-OAuth) | High |
| API-05 | Broken Function Level Authorization | High |
| API-06 | Mass Assignment (parameter pollution) | Medium |
| API-07 | Security Misconfiguration (CORS, debug, verbose errors) | Medium |
| API-08 | Improper Assets Management (undocumented endpoints) | Medium |
| API-09 | Business logic abuse (debate manipulation, receipt forgery) | High |
| API-10 | Unrestricted Resource Consumption (DoS via expensive operations) | Medium |

#### E. WebSocket Security

| Test | Description | Priority |
|------|-------------|----------|
| WS-01 | Authentication on upgrade handshake (all 8 WS servers) | Critical |
| WS-02 | Authorization for event subscriptions | High |
| WS-03 | Message size limits and connection exhaustion | High |
| WS-04 | Resume token replay and session hijacking | High |
| WS-05 | Cross-origin WebSocket hijacking (Origin header validation) | High |
| WS-06 | Binary frame parsing abuse (Oracle stream phase tags) | Medium |
| WS-07 | Cross-debate/cross-tenant event leakage | High |
| WS-08 | WebSocket denial of service (slowloris, fragmentation) | Medium |

#### F. Cryptographic Controls (OWASP A02)

| Test | Description | Priority |
|------|-------------|----------|
| CRYPTO-01 | AES-256-GCM implementation correctness (nonce reuse, AAD) | High |
| CRYPTO-02 | Key rotation completeness (old data re-encrypted) | High |
| CRYPTO-03 | JWT signing key management (rotation, key material exposure) | High |
| CRYPTO-04 | PBKDF2 password hashing (iteration count, salt uniqueness) | Medium |
| CRYPTO-05 | TLS configuration (cipher suites, protocol versions) | Medium |
| CRYPTO-06 | Decision receipt integrity (SHA-256 hash chain tampering) | High |
| CRYPTO-07 | Credential encryption fallback (verify base64 blocked in prod) | High |

#### G. SSRF and External Request Safety

| Test | Description | Priority |
|------|-------------|----------|
| SSRF-01 | SSRF via OpenClaw NavigateAction (prior finding F07) | Critical |
| SSRF-02 | SSRF via webhook URL configuration | High |
| SSRF-03 | SSRF via OIDC discovery URL | High |
| SSRF-04 | DNS rebinding attacks against SSRF protection | High |
| SSRF-05 | Cloud metadata endpoint access (169.254.169.254) | High |
| SSRF-06 | Protocol smuggling (file://, gopher://, dict://) | Medium |

#### H. File Upload and Data Handling

| Test | Description | Priority |
|------|-------------|----------|
| FILE-01 | Path traversal in upload filenames | High |
| FILE-02 | MIME type spoofing and polyglot files | Medium |
| FILE-03 | Zip bomb / decompression bomb | Medium |
| FILE-04 | Upload rate limit bypass | Medium |
| FILE-05 | Stored XSS via uploaded filenames/content | Medium |

#### I. Sandbox and Agent Security

| Test | Description | Priority |
|------|-------------|----------|
| SAND-01 | Docker sandbox escape | Critical |
| SAND-02 | Sandbox resource exhaustion (CPU, memory, disk) | High |
| SAND-03 | Filesystem access beyond workspace scope | High |
| SAND-04 | Network access from sandbox (egress filtering) | High |
| SAND-05 | Agent credential leakage in responses/errors | High |
| SAND-06 | Malware pattern detection bypass in skill scanner | Medium |

---

## 5. Existing Security Controls

The following controls are implemented and should be validated during testing. Successful
bypass of any control constitutes a finding.

### 5.1 Authentication Controls

| # | Control | Implementation |
|---|---------|----------------|
| 1 | JWT token validation | PyJWT with algorithm restriction, expiration, issuer validation |
| 2 | OIDC with PKCE | State parameter, nonce, authorization code flow |
| 3 | SAML signature validation | `python3-saml` with `defusedxml` (XXE-safe XML parsing) |
| 4 | MFA enforcement | TOTP/HOTP for admin roles (8 roles require MFA by default) |
| 5 | Account lockout | Configurable threshold and duration |
| 6 | Token rotation | Automatic rotation on max-use, time, IP change, suspicious activity |
| 7 | Token revocation | Blacklist checking on every request via middleware |
| 8 | Session monitoring | Active session tracking and concurrent session management |
| 9 | Production-safe defaults | `_is_production_mode()` defaults to production (secure by default) |

### 5.2 Authorization Controls

| # | Control | Implementation |
|---|---------|----------------|
| 10 | RBAC decorators | `@require_permission` on all 193+ handler write methods (POST/PUT/PATCH/DELETE) |
| 11 | `@handle_errors` decorator | Outermost decorator on all handler write methods, sanitizes errors |
| 12 | Ownership verification | Non-admins restricted to own resources |
| 13 | Impersonation safeguards | Approver IDs forced to authenticated user identity |
| 14 | Tenant isolation middleware | Fail-closed membership checks via `tenant_isolation.py` |
| 15 | Approval gate middleware | Sensitive operations require approval workflow |
| 16 | Budget enforcement middleware | Cost budget enforcement per user/tenant |
| 17 | Tier enforcement middleware | Feature gating by subscription tier |

### 5.3 Input Validation Controls

| # | Control | Implementation |
|---|---------|----------------|
| 18 | Input validation | Strict regex whitelisting, shell metacharacter blocking |
| 19 | Body size limits | `MAX_JSON_CONTENT_LENGTH`, `MAX_CONTENT_LENGTH = 100MB` |
| 20 | Rate limiting | Multi-tier: IP, user, tenant, OAuth client, platform (Redis-backed distributed) |
| 21 | Request timeout | Configurable per-request timeout enforcement |
| 22 | Parameterized SQL | Throughout the codebase (verified in OpenClaw audit) |
| 23 | SSRF protection | Private IP blocking, DNS rebinding checks, cloud metadata blocking, protocol restriction |
| 24 | Safe HTTP wrappers | `safe_get()`, `safe_post()` with built-in SSRF validation |
| 25 | File upload validation | MIME whitelist, size limits, path traversal prevention, null byte detection |

### 5.4 Output and Transport Controls

| # | Control | Implementation |
|---|---------|----------------|
| 26 | Safe error messages | `safe_error_message()` sanitizes exception details (no `str(e)` leaks) |
| 27 | CSRF protection | Double-submit cookie pattern with HMAC-signed tokens |
| 28 | Security headers | X-Frame-Options: DENY, CSP, HSTS, X-Content-Type-Options: nosniff |
| 29 | XSS protection | HTML escaping via `markupsafe`, CSP nonce generation, cookie security |
| 30 | CORS configuration | Default restricted to localhost (production requires explicit origins) |
| 31 | Credential data separation | Secrets never returned in API responses |

### 5.5 Cryptographic Controls

| # | Control | Implementation |
|---|---------|----------------|
| 32 | AES-256-GCM encryption | Field-level encryption for sensitive data at rest |
| 33 | PBKDF2 key derivation | Password-based key derivation |
| 34 | Key rotation | Automated 30/60/90-day rotation with KMS integration |
| 35 | API key proxy | Envelope encryption, frequency-hopping rotation, usage anomaly detection |
| 36 | Decision receipt integrity | SHA-256 hash chains for audit trail tamper detection |

### 5.6 Monitoring and Detection

| # | Control | Implementation |
|---|---------|----------------|
| 37 | Anomaly detection | Brute force, credential stuffing, impossible travel, unusual time, behavioral |
| 38 | Comprehensive audit logging | Actor, resource, action, result, timestamp on all state changes |
| 39 | Rate anomaly detection | API spike, request flood, data exfiltration pattern detection |
| 40 | Threat intelligence | Tor exit node detection, known-bad IP checking, unusual country alerts |
| 41 | Request correlation | Distributed tracing with correlation IDs (OpenTelemetry) |
| 42 | Circuit breaker | Threshold=5, cooldown=30s, prevents cascading failures |

---

## 6. Known Attack Vectors to Test (From Prior Assessments)

### 6.1 OpenClaw Audit Findings (February 2026) -- Retest Required

All 13 findings were reported as remediated. Independent revalidation is required.

| ID | Severity | Finding | Status | Retest Priority |
|----|----------|---------|--------|-----------------|
| F01 | Critical | Standalone server no authentication | Fixed (API key auth) | Must retest |
| F02 | High | Credential encryption fallback to base64 | Fixed (blocked in prod) | Must retest |
| F03 | High | Unbounded request body | Fixed (1MB limit, HTTP 413) | Must retest |
| F04 | High | Unbounded header count | Fixed (100 limit, HTTP 431) | Must retest |
| F05 | Medium | CORS wildcard default | Fixed (restricted to localhost) | Retest |
| F06 | Medium | OpenClaw routes missing from RBAC middleware | Review status | Retest |
| F07 | Medium | NavigateAction SSRF | Review status | Must retest |
| F08 | Medium | Health endpoint leaks exceptions | Review status | Retest |
| F09 | Low | Query params not URL-decoded | Review status | Retest |
| F10 | Low | No session expiration | Fixed (expiration added) | Retest |
| F11 | Low | Audit log 10K-entry cap | Accepted risk | Verify documentation |

### 6.2 Gauntlet Red Team Attack Categories

The Gauntlet framework (`aragora/gauntlet/`) defines the following attack categories. The
pentest should validate that these vectors are mitigated at the application layer:

**Security attacks:** `injection`, `privilege_escalation`, `adversarial_input`

**Compliance attacks:** `gdpr`, `hipaa`, `ai_act`, `regulatory_violation`

**Architecture attacks:** `resource_exhaustion`, `scalability`, `performance`

**Logic attacks:** `edge_cases`, `race_conditions`, `dependency_failure`

**Probe categories (AI-specific):** `prompt_injection`, `jailbreak`, `data_extraction`,
`boundary_testing`, `role_confusion`, `hallucination`, `sycophancy`, `contradiction`,
`instruction_injection`, `capability_exaggeration`

### 6.3 Gauntlet Red Team Playbooks

Pre-built adversarial playbooks are available for reference (not to be executed verbatim):

| Playbook | File | Focus |
|----------|------|-------|
| Security Red Team | `aragora/gauntlet/playbooks/security-red-team.json` | Prompt injection, jailbreak, data extraction, boundary testing, role confusion |
| SOC 2 Readiness | `aragora/gauntlet/playbooks/soc2-readiness.json` | SOC 2 trust criteria validation |
| GDPR Compliance | `aragora/gauntlet/playbooks/gdpr-compliance.json` | GDPR data protection validation |
| Architecture Stress | `aragora/gauntlet/playbooks/architecture-stress-test.json` | Scalability and performance under adversarial load |
| API Design Review | `aragora/gauntlet/playbooks/api-design-review.json` | API security and design best practices |

---

## 7. Severity Classification

| Severity | CVSS v3.1 Range | Response SLA | Examples |
|----------|-----------------|--------------|---------|
| Critical | 9.0--10.0 | 48 hours | RCE, authentication bypass, mass data exposure, cross-tenant data leak |
| High | 7.0--8.9 | 7 days | Privilege escalation, SQL injection, significant data leak, SSRF to internal services |
| Medium | 4.0--6.9 | 30 days | Stored XSS, IDOR with limited impact, information disclosure, CSRF |
| Low | 0.1--3.9 | 90 days | Reflected XSS, verbose errors, missing headers, cookie flags |
| Informational | 0 | Best effort | Best practice recommendations, defense-in-depth suggestions |

---

## 8. Deliverables

### Required Deliverables

1. **Executive Summary** (1--2 pages): Overall risk rating, key findings count by severity,
   top 3 recommendations, comparison with prior assessment findings.

2. **Technical Findings Report**: For each finding:
   - Unique finding ID and title
   - CVSS v3.1 score and vector string
   - CWE reference and OWASP category
   - Affected component and source location
   - Detailed description and business impact
   - Step-by-step reproduction (with HTTP requests/responses)
   - Evidence (screenshots, request/response pairs, payloads)
   - Remediation recommendations (specific, actionable)
   - Verification test (how to confirm the fix)

3. **Retest Report**: Verification status of all 13 prior OpenClaw findings.

4. **Appendices**:
   - Tools used with versions
   - Testing timeline (day-by-day activity log)
   - Raw scan data (Burp Suite project, nuclei results, etc.)
   - Positive findings (controls validated as effective)

### Report Format

- PDF with table of contents and cross-references
- Machine-readable findings export (JSON or CSV) for tracking
- Findings mapped to CWE and OWASP categories

---

## 9. Timeline and Contacts

### Engagement Timeline

| Phase | Duration | Activities |
|-------|----------|------------|
| Kickoff | Day 1 | Scope review, credential provisioning, tooling setup |
| Reconnaissance | Days 2--3 | API discovery, endpoint enumeration, OpenAPI spec analysis |
| Authentication testing | Days 4--6 | OIDC, SAML, MFA, session management, API keys |
| Authorization testing | Days 7--9 | RBAC, ABAC, tenant isolation, IDOR, privilege escalation |
| Injection and input testing | Days 10--12 | SQL, prompt, command, SSRF, file upload, WebSocket |
| AI-specific and business logic | Days 13--14 | Prompt injection, sandbox escape, agent security |
| OpenClaw retest | Day 15 | Revalidation of 13 prior findings |
| Reporting | Days 16--20 | Draft report, review call, final report delivery |

### Contacts

| Role | Name | Contact | Availability |
|------|------|---------|--------------|
| Security Lead | [REDACTED] | [REDACTED] | Business hours + Critical finding escalation |
| Engineering Lead | [REDACTED] | [REDACTED] | Business hours |
| DevOps / Infra | [REDACTED] | [REDACTED] | Business hours |
| Executive Sponsor | [REDACTED] | [REDACTED] | Escalation only |

### Communication Protocol

- **Daily standup**: 15-minute check-in via secure channel (Signal/Slack private channel)
- **Critical findings**: Immediate notification to Security Lead via phone + encrypted email
- **Questions/blockers**: Async via secure channel, 4-hour response SLA during business hours
- **Status reports**: Weekly written summary of testing progress and preliminary findings

---

## 10. Environment Details

### Staging Environment

| Component | URL / Endpoint | Notes |
|-----------|----------------|-------|
| HTTP API | `https://staging-api.aragora.io` | [To be provisioned] |
| WebSocket | `wss://staging-api.aragora.io/ws/*` | [To be provisioned] |
| OpenAPI Spec | `https://staging-api.aragora.io/api/openapi.json` | 2,775 paths documented |
| Health Check | `https://staging-api.aragora.io/healthz` | Unauthenticated |
| SCIM Endpoint | `https://staging-api.aragora.io/scim/v2/` | Bearer token auth |

### Credential Provisioning

The following test accounts will be provisioned in the staging environment:

| Account | Role | MFA | Purpose |
|---------|------|-----|---------|
| `pentest-admin@aragora.test` | `superadmin` | Enabled (TOTP) | Admin-level access testing |
| `pentest-editor@aragora.test` | `editor` | Disabled | Standard user access testing |
| `pentest-viewer@aragora.test` | `viewer` | Disabled | Read-only access testing |
| `pentest-tenant-a@aragora.test` | `admin` (Tenant A) | Disabled | Cross-tenant isolation testing |
| `pentest-tenant-b@aragora.test` | `admin` (Tenant B) | Disabled | Cross-tenant isolation testing |
| API Key (admin scope) | N/A | N/A | API key authentication testing |
| API Key (limited scope) | N/A | N/A | API key scope enforcement testing |
| SCIM Bearer Token | N/A | N/A | SCIM provisioning testing |

**Credential delivery:** Credentials will be delivered via a secure channel (1Password vault
or PGP-encrypted email) at kickoff. Credentials will be rotated post-engagement.

### Data Seeding

The staging environment will be pre-seeded with:

- 3 tenants (Tenant A, Tenant B, Shared) with distinct data sets
- 10+ completed debates with decision receipts per tenant
- Knowledge Mound entries across multiple adapters
- Workflow definitions and pipeline configurations
- File uploads (documents, audio, images)
- Audit log entries spanning 30 days

### Tooling Access

| Resource | Access Method |
|----------|--------------|
| OpenAPI specification | Download from staging or `docs/api/openapi.json` in repo |
| Architecture documentation | Provided at kickoff (this document + THREAT_MODEL.md) |
| Source code (read-only) | Available on request for gray-box validation |
| Burp Suite configuration | Custom Burp project with API scope pre-configured |

### Environment Restrictions

- **No production testing**: All testing must occur on the staging environment
- **No data destruction**: Do not delete seeded test data; create new resources for testing
- **No automated scanning without coordination**: Coordinate large-scale scans with DevOps
  to avoid alerting and resource exhaustion
- **Testing hours**: 24/7 testing permitted on staging; notify DevOps before heavy load tests
- **VPN**: VPN access may be required; details provided at kickoff

---

## 11. Compliance Context

The pentest findings will be used to satisfy compliance requirements across multiple frameworks:

| Framework | Requirement | How Pentest Satisfies |
|-----------|-------------|----------------------|
| SOC 2 Type II | CC7.1 (Security Testing) | Annual pentest with remediation tracking |
| GDPR | Art. 32 (Security of Processing) | Validates technical measures for data protection |
| HIPAA | 164.308(a)(8) (Evaluation) | Technical evaluation of security controls |
| EU AI Act | Art. 15 (Accuracy, Robustness, Cybersecurity) | Validates cybersecurity measures for high-risk AI |
| ISO 27001 | A.18.2.3 (Technical Compliance Review) | Technical security assessment |

Findings rated High or Critical will be tracked in the compliance remediation register and
reported to the compliance officer within 24 hours of final report delivery.

---

## 12. Legal and Confidentiality

- This document and all pentest deliverables are classified as **CONFIDENTIAL**
- Distribution is limited to authorized security, engineering, and compliance personnel
- The testing firm must sign an NDA and a Rules of Engagement agreement before work begins
- All test data, credentials, and findings must be securely destroyed 90 days after
  final report delivery, with written confirmation
- The testing firm must carry professional liability insurance with a minimum coverage
  of $2M per occurrence
- Findings must not be disclosed publicly without written authorization from Aragora

---

*This document is confidential and intended only for authorized penetration testing personnel.
Unauthorized distribution is prohibited.*

*Document version history: v1.0.0 (Feb 2026, initial), v2.0.0 (Feb 2026, OpenClaw audit
integration), v3.0.0 (Feb 2026, full platform scope with methodology, timeline, environment).*
