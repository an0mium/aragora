openapi: 3.0.3
info:
  title: Aragora API
  description: |
    AI red team / decision stress-test API for orchestrating adversarial reviews,
    tracking agent performance, and managing consensus memory.

    ## Authentication
    Protected endpoints require a Bearer token in the Authorization header:
    ```
    Authorization: Bearer <token>
    ```

    ## Rate Limiting
    Query parameters have maximum values to prevent abuse.
    Responses include cache headers where applicable.
  version: 1.0.0
  contact:
    name: Aragora Team
  license:
    name: MIT

servers:
  - url: http://localhost:8080
    description: Local development server

tags:
  - name: Debates
    description: Debate management and history
  - name: Agents
    description: Agent profiles, rankings, and performance
  - name: System
    description: Health checks and system status
  - name: Consensus
    description: Consensus memory and dissent tracking
  - name: Memory
    description: Continuum memory management
  - name: Tournaments
    description: Tournament management
  - name: Replays
    description: Debate replay access
  - name: Documents
    description: Document upload and management
  - name: Verification
    description: Formal verification of claims
  - name: Analytics
    description: System analytics and metrics
  - name: Relationships
    description: Agent relationship tracking
  - name: Moments
    description: Significant debate moments
  - name: Dashboard
    description: Dashboard aggregated data
  - name: Probes
    description: Capability probing and vulnerability detection
  - name: Evolution
    description: Prompt evolution and pattern extraction
  - name: Broadcast
    description: Podcast generation and publishing
  - name: Laboratory
    description: Persona laboratory and emergent traits
  - name: Insights
    description: Insight extraction and analysis
  - name: Routing
    description: Agent routing and team selection
  - name: Pulse
    description: Trending topics and pulse monitoring
  - name: Integrations
    description: Slack, Discord, and webhook integrations

paths:
  # =============================================================================
  # DEBATES
  # =============================================================================
  /api/debates:
    get:
      tags: [Debates]
      summary: List all debates
      description: Returns a paginated list of recent debates
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Maximum number of debates to return
      responses:
        '200':
          description: List of debates
          content:
            application/json:
              schema:
                type: object
                properties:
                  debates:
                    type: array
                    items:
                      $ref: '#/components/schemas/DebateSummary'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      tags: [Debates]
      summary: Create a new debate
      description: Starts an ad-hoc debate with the provided task/question.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DebateCreateRequest'
      responses:
        '200':
          description: Debate created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DebateCreateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          description: Quota exceeded
        '429':
          $ref: '#/components/responses/RateLimited'

  # Legacy endpoint - DEPRECATED. Use POST /api/debates instead.
  /api/debate:
    post:
      tags: [Debates]
      summary: Create a new debate (DEPRECATED)
      description: |
        **DEPRECATED**: This endpoint will be removed on 2026-08-01.
        Use POST /api/debates instead.
      deprecated: true
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DebateCreateRequest'
      responses:
        '200':
          description: Debate created successfully
          headers:
            Deprecation:
              schema:
                type: string
              description: Indicates this endpoint is deprecated
            Sunset:
              schema:
                type: string
              description: Date when this endpoint will be removed (RFC 8594)
            Link:
              schema:
                type: string
              description: Link to successor endpoint
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DebateCreateResponse'
        '400':
          description: Invalid request body
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          description: Quota exceeded
        '429':
          $ref: '#/components/responses/RateLimited'

  /api/debates/slug/{slug}:
    get:
      tags: [Debates]
      summary: Get debate by slug
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
            pattern: '^[a-zA-Z0-9_-]+$'
      responses:
        '200':
          description: Debate details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Debate'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/debates/{id}/export/{format}:
    get:
      tags: [Debates]
      summary: Export debate
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: format
          in: path
          required: true
          schema:
            type: string
            enum: [json, csv, html]
        - name: table
          in: query
          schema:
            type: string
            enum: [summary, messages, critiques, votes]
      responses:
        '200':
          description: Exported debate data
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/debates/{id}/impasse:
    get:
      tags: [Debates]
      summary: Detect debate impasse
      description: Analyzes debate for signs of stalemate or circular arguments
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Impasse analysis
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImpasseAnalysis'

  /api/debates/{id}/convergence:
    get:
      tags: [Debates]
      summary: Get convergence status
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Convergence metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConvergenceStatus'

  /api/debates/{id}/citations:
    get:
      tags: [Debates]
      summary: Get evidence citations
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Evidence citations and grounded verdict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Citations'

  /api/debates/{id}/fork:
    post:
      tags: [Debates]
      summary: Fork debate at branch point
      description: Create a counterfactual fork of the debate
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [branch_point]
              properties:
                branch_point:
                  type: integer
                  description: Round number to fork from
                modified_context:
                  type: string
                  description: Optional modified context for the fork
      responses:
        '200':
          description: Forked debate created
        '401':
          $ref: '#/components/responses/Unauthorized'

  # =============================================================================
  # AGENTS
  # =============================================================================
  /api/leaderboard:
    get:
      tags: [Agents]
      summary: Get agent rankings
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: domain
          in: query
          schema:
            type: string
          description: Filter by domain
      responses:
        '200':
          description: Agent leaderboard
          content:
            application/json:
              schema:
                type: object
                properties:
                  leaderboard:
                    type: array
                    items:
                      $ref: '#/components/schemas/LeaderboardEntry'

  /api/matches/recent:
    get:
      tags: [Agents]
      summary: Get recent matches
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
        - name: loop_id
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Recent matches
          content:
            application/json:
              schema:
                type: object
                properties:
                  matches:
                    type: array
                    items:
                      $ref: '#/components/schemas/Match'

  /api/agent/{name}/profile:
    get:
      tags: [Agents]
      summary: Get agent profile
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
            pattern: '^[a-zA-Z0-9_-]+$'
      responses:
        '200':
          description: Agent profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentProfile'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/agent/{name}/history:
    get:
      tags: [Agents]
      summary: Get agent match history
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 30
      responses:
        '200':
          description: Match history
          content:
            application/json:
              schema:
                type: object
                properties:
                  history:
                    type: array
                    items:
                      $ref: '#/components/schemas/MatchHistoryEntry'

  /api/agent/{name}/consistency:
    get:
      tags: [Agents]
      summary: Get consistency score
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Consistency metrics from flip detector
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsistencyScore'

  /api/agent/{name}/network:
    get:
      tags: [Agents]
      summary: Get relationship network
      description: Returns rivals and allies for the agent
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Relationship network
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipNetwork'

  /api/agent/compare:
    get:
      tags: [Agents]
      summary: Compare multiple agents
      parameters:
        - name: agents
          in: query
          required: true
          schema:
            type: array
            items:
              type: string
            minItems: 2
            maxItems: 5
          style: form
          explode: true
      responses:
        '200':
          description: Agent comparison
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentComparison'

  /api/flips/recent:
    get:
      tags: [Agents]
      summary: Get recent position flips
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Recent position flips
          content:
            application/json:
              schema:
                type: object
                properties:
                  flips:
                    type: array
                    items:
                      $ref: '#/components/schemas/PositionFlip'

  # =============================================================================
  # SYSTEM
  # =============================================================================
  /api/health:
    get:
      tags: [System]
      summary: Health check
      responses:
        '200':
          description: System healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [healthy, degraded]
        '503':
          description: System degraded

  /api/health/detailed:
    get:
      tags: [System]
      summary: Detailed health check
      responses:
        '200':
          description: Detailed health metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailedHealth'

  /api/nomic/state:
    get:
      tags: [System]
      summary: Get nomic loop state
      responses:
        '200':
          description: Current nomic state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NomicState'

  /api/nomic/health:
    get:
      tags: [System]
      summary: Get nomic health
      description: Includes stall detection (30 minute threshold)
      responses:
        '200':
          description: Nomic health status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NomicHealth'

  /api/modes:
    get:
      tags: [System]
      summary: Get available modes
      responses:
        '200':
          description: Available operational modes
          content:
            application/json:
              schema:
                type: object
                properties:
                  modes:
                    type: array
                    items:
                      $ref: '#/components/schemas/Mode'

  # =============================================================================
  # CONSENSUS
  # =============================================================================
  /api/consensus/similar:
    get:
      tags: [Consensus]
      summary: Find similar debates
      parameters:
        - name: topic
          in: query
          required: true
          schema:
            type: string
            maxLength: 500
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 20
            default: 5
      responses:
        '200':
          description: Similar debates
          content:
            application/json:
              schema:
                type: object
                properties:
                  similar:
                    type: array
                    items:
                      $ref: '#/components/schemas/SimilarDebate'

  /api/consensus/settled:
    get:
      tags: [Consensus]
      summary: Get settled topics
      parameters:
        - name: min_confidence
          in: query
          schema:
            type: number
            format: float
            minimum: 0.0
            maximum: 1.0
            default: 0.8
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: High-confidence settled topics
          content:
            application/json:
              schema:
                type: object
                properties:
                  settled:
                    type: array
                    items:
                      $ref: '#/components/schemas/SettledTopic'

  /api/consensus/stats:
    get:
      tags: [Consensus]
      summary: Get consensus statistics
      responses:
        '200':
          description: Consensus memory statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsensusStats'

  /api/consensus/dissents:
    get:
      tags: [Consensus]
      summary: Get dissenting views
      parameters:
        - name: topic
          in: query
          schema:
            type: string
        - name: domain
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: Recent dissenting views
          content:
            application/json:
              schema:
                type: object
                properties:
                  dissents:
                    type: array
                    items:
                      $ref: '#/components/schemas/Dissent'

  # =============================================================================
  # MEMORY
  # =============================================================================
  /api/memory/continuum/retrieve:
    get:
      tags: [Memory]
      summary: Retrieve memories
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
            maxLength: 500
        - name: tiers
          in: query
          schema:
            type: array
            items:
              type: string
              enum: [fast, medium, slow, glacial]
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: min_importance
          in: query
          schema:
            type: number
            format: float
            minimum: 0.0
            maximum: 1.0
            default: 0.0
      responses:
        '200':
          description: Retrieved memories
          content:
            application/json:
              schema:
                type: object
                properties:
                  memories:
                    type: array
                    items:
                      $ref: '#/components/schemas/Memory'

  /api/memory/continuum/consolidate:
    post:
      tags: [Memory]
      summary: Trigger consolidation
      responses:
        '200':
          description: Consolidation triggered
          content:
            application/json:
              schema:
                type: object
                properties:
                  promoted:
                    type: integer
                  demoted:
                    type: integer

  /api/memory/tier-stats:
    get:
      tags: [Memory]
      summary: Get tier statistics
      responses:
        '200':
          description: Memory tier statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TierStats'

  # =============================================================================
  # TOURNAMENTS
  # =============================================================================
  /api/tournaments:
    get:
      tags: [Tournaments]
      summary: List tournaments
      responses:
        '200':
          description: Available tournaments
          content:
            application/json:
              schema:
                type: object
                properties:
                  tournaments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Tournament'

  /api/tournaments/{id}/standings:
    get:
      tags: [Tournaments]
      summary: Get tournament standings
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Tournament standings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentStandings'

  # =============================================================================
  # REPLAYS
  # =============================================================================
  /api/replays:
    get:
      tags: [Replays]
      summary: List replays
      responses:
        '200':
          description: Available replays
          content:
            application/json:
              schema:
                type: object
                properties:
                  replays:
                    type: array
                    items:
                      $ref: '#/components/schemas/ReplaySummary'

  /api/replays/{replay_id}:
    get:
      tags: [Replays]
      summary: Get replay
      parameters:
        - name: replay_id
          in: path
          required: true
          schema:
            type: string
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5000
            default: 1000
      responses:
        '200':
          description: Replay events
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Replay'

  # =============================================================================
  # DOCUMENTS
  # =============================================================================
  /api/documents:
    get:
      tags: [Documents]
      summary: List documents
      responses:
        '200':
          description: Uploaded documents
          content:
            application/json:
              schema:
                type: object
                properties:
                  documents:
                    type: array
                    items:
                      $ref: '#/components/schemas/DocumentSummary'

  /api/documents/formats:
    get:
      tags: [Documents]
      summary: Get supported formats
      responses:
        '200':
          description: Supported document formats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupportedFormats'

  /api/documents/{doc_id}:
    get:
      tags: [Documents]
      summary: Get document
      parameters:
        - name: doc_id
          in: path
          required: true
          schema:
            type: string
            pattern: '^[a-zA-Z0-9_-]+$'
      responses:
        '200':
          description: Document content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Document'
        '404':
          $ref: '#/components/responses/NotFound'

  # =============================================================================
  # VERIFICATION
  # =============================================================================
  /api/verification/status:
    get:
      tags: [Verification]
      summary: Get verification backend status
      responses:
        '200':
          description: Backend availability (Z3, Lean)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerificationStatus'

  /api/verification/formal-verify:
    post:
      tags: [Verification]
      summary: Verify claim formally
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [claim]
              properties:
                claim:
                  type: string
                  description: Claim to verify
                claim_type:
                  type: string
                context:
                  type: string
                timeout:
                  type: integer
                  minimum: 1
                  maximum: 120
                  default: 30
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerificationResult'

  # =============================================================================
  # ANALYTICS
  # =============================================================================
  /api/analytics/disagreements:
    get:
      tags: [Analytics]
      summary: Get disagreement statistics
      responses:
        '200':
          description: Disagreement metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DisagreementStats'

  /api/ranking/stats:
    get:
      tags: [Analytics]
      summary: Get ranking statistics
      responses:
        '200':
          description: Ranking system statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RankingStats'

  # =============================================================================
  # RELATIONSHIPS
  # =============================================================================
  /api/relationships/summary:
    get:
      tags: [Relationships]
      summary: Get relationship overview
      responses:
        '200':
          description: Global relationship summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipSummary'

  /api/relationships/graph:
    get:
      tags: [Relationships]
      summary: Get relationship graph
      parameters:
        - name: min_debates
          in: query
          schema:
            type: integer
            default: 3
        - name: min_score
          in: query
          schema:
            type: number
            format: float
            default: 0.0
      responses:
        '200':
          description: Full relationship graph
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipGraph'

  /api/relationship/{agent_a}/{agent_b}:
    get:
      tags: [Relationships]
      summary: Get relationship between agents
      parameters:
        - name: agent_a
          in: path
          required: true
          schema:
            type: string
        - name: agent_b
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detailed relationship
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Relationship'

  # =============================================================================
  # MOMENTS
  # =============================================================================
  /api/moments/summary:
    get:
      tags: [Moments]
      summary: Get moments overview
      responses:
        '200':
          description: Global moments summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MomentsSummary'

  /api/moments/timeline:
    get:
      tags: [Moments]
      summary: Get moments timeline
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Chronological moments
          content:
            application/json:
              schema:
                type: object
                properties:
                  moments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Moment'

  /api/moments/trending:
    get:
      tags: [Moments]
      summary: Get trending moments
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: Most significant recent moments
          content:
            application/json:
              schema:
                type: object
                properties:
                  moments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Moment'

  # =============================================================================
  # DASHBOARD
  # =============================================================================
  /api/dashboard/debates:
    get:
      tags: [Dashboard]
      summary: Get dashboard debate metrics
      parameters:
        - name: domain
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
        - name: hours
          in: query
          schema:
            type: integer
            default: 24
      responses:
        '200':
          description: Consolidated debate metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardMetrics'

  # =============================================================================
  # PULSE (TRENDING)
  # =============================================================================
  /api/pulse/trending:
    get:
      tags: [Pulse]
      summary: Get trending topics
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: Trending topics from HackerNews, Reddit, Twitter
          content:
            application/json:
              schema:
                type: object
                properties:
                  topics:
                    type: array
                    items:
                      $ref: '#/components/schemas/TrendingTopic'

  /api/pulse/debate-topic:
    post:
      tags: [Pulse]
      summary: Start a debate on a trending topic
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [topic]
              properties:
                topic:
                  type: string
                  description: Topic to debate
                rounds:
                  type: integer
                  minimum: 1
                  maximum: 10
                  default: 3
                consensus_threshold:
                  type: number
                  minimum: 0
                  maximum: 1
                  default: 0.7
      responses:
        '200':
          description: Debate started
          content:
            application/json:
              schema:
                type: object
                properties:
                  debate_id:
                    type: string
                  topic:
                    type: string
                  status:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/pulse/scheduler/status:
    get:
      tags: [Pulse]
      summary: Get pulse scheduler status
      responses:
        '200':
          description: Current scheduler state and metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchedulerStatus'

  /api/pulse/scheduler/start:
    post:
      tags: [Pulse]
      summary: Start the pulse scheduler
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Scheduler started
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  run_id:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/pulse/scheduler/stop:
    post:
      tags: [Pulse]
      summary: Stop the pulse scheduler
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Scheduler stopped
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/pulse/scheduler/pause:
    post:
      tags: [Pulse]
      summary: Pause the pulse scheduler
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Scheduler paused
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/pulse/scheduler/resume:
    post:
      tags: [Pulse]
      summary: Resume the pulse scheduler
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Scheduler resumed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/pulse/scheduler/config:
    patch:
      tags: [Pulse]
      summary: Update scheduler configuration
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                poll_interval_seconds:
                  type: integer
                  minimum: 60
                  maximum: 3600
                max_debates_per_hour:
                  type: integer
                  minimum: 1
                  maximum: 20
                min_volume_threshold:
                  type: integer
                  minimum: 0
                min_controversy_score:
                  type: number
                  minimum: 0
                  maximum: 1
                dedup_window_hours:
                  type: integer
                  minimum: 1
                  maximum: 168
      responses:
        '200':
          description: Configuration updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  config:
                    type: object
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/pulse/scheduler/history:
    get:
      tags: [Pulse]
      summary: Get scheduled debate history
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: platform
          in: query
          schema:
            type: string
        - name: category
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Scheduled debate history
          content:
            application/json:
              schema:
                type: object
                properties:
                  history:
                    type: array
                    items:
                      $ref: '#/components/schemas/ScheduledDebateRecord'
                  total:
                    type: integer

  # =============================================================================
  # SLACK INTEGRATION
  # =============================================================================
  /api/integrations/slack/status:
    get:
      tags: [Integrations]
      summary: Get Slack integration status
      responses:
        '200':
          description: Slack integration status
          content:
            application/json:
              schema:
                type: object
                properties:
                  enabled:
                    type: boolean
                  signing_secret_configured:
                    type: boolean
                  bot_token_configured:
                    type: boolean
                  webhook_configured:
                    type: boolean

  /api/integrations/slack/commands:
    post:
      tags: [Integrations]
      summary: Handle Slack slash commands
      description: Endpoint for Slack to POST slash command payloads
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                command:
                  type: string
                text:
                  type: string
                user_id:
                  type: string
                channel_id:
                  type: string
                response_url:
                  type: string
      responses:
        '200':
          description: Command response
          content:
            application/json:
              schema:
                type: object
                properties:
                  response_type:
                    type: string
                    enum: [ephemeral, in_channel]
                  text:
                    type: string
                  blocks:
                    type: array
                    items:
                      type: object

  /api/integrations/slack/interactive:
    post:
      tags: [Integrations]
      summary: Handle Slack interactive components
      description: Endpoint for Slack interactive component callbacks
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                payload:
                  type: string
                  description: JSON-encoded interaction payload
      responses:
        '200':
          description: Interaction acknowledged
          content:
            application/json:
              schema:
                type: object

  /api/integrations/slack/events:
    post:
      tags: [Integrations]
      summary: Handle Slack Events API
      description: Endpoint for Slack event subscriptions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                challenge:
                  type: string
                event:
                  type: object
      responses:
        '200':
          description: Event acknowledged
          content:
            application/json:
              schema:
                type: object

  # =============================================================================
  # PROBES (Capability Testing)
  # =============================================================================
  /api/probes/capability:
    post:
      tags: [Probes]
      summary: Run capability probes on an agent
      description: |
        Execute capability probes to detect vulnerabilities and weaknesses.
        Probes test for contradiction handling, hallucination, sycophancy, and more.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [agent_name]
              properties:
                agent_name:
                  type: string
                  description: Name of the agent to probe
                probe_types:
                  type: array
                  items:
                    type: string
                    enum: [contradiction, hallucination, sycophancy, persistence, confidence_calibration, reasoning_depth, edge_case]
                  description: Types of probes to run (default all)
                probes_per_type:
                  type: integer
                  minimum: 1
                  maximum: 10
                  default: 3
                  description: Number of probes per type
                model_type:
                  type: string
                  default: anthropic-api
                  description: Agent model type
      responses:
        '200':
          description: Probe results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProbeReport'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimited'
        '503':
          description: Prober not available

  # =============================================================================
  # LABORATORY (Emergent Traits)
  # =============================================================================
  /api/laboratory/emergent-traits:
    get:
      tags: [Laboratory]
      summary: Get emergent traits from agent performance
      description: Detect emergent behavioral traits from agent debate patterns
      parameters:
        - name: min_confidence
          in: query
          schema:
            type: number
            format: float
            minimum: 0.0
            maximum: 1.0
            default: 0.5
          description: Minimum confidence threshold
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Emergent traits list
          content:
            application/json:
              schema:
                type: object
                properties:
                  emergent_traits:
                    type: array
                    items:
                      $ref: '#/components/schemas/EmergentTrait'
                  count:
                    type: integer
                  min_confidence:
                    type: number
        '503':
          description: Laboratory not available

  /api/laboratory/cross-pollinations/suggest:
    post:
      tags: [Laboratory]
      summary: Suggest beneficial trait transfers
      description: Analyze agents and suggest which traits could be transferred between them
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                source_agents:
                  type: array
                  items:
                    type: string
                target_agents:
                  type: array
                  items:
                    type: string
                min_benefit_score:
                  type: number
                  format: float
                  default: 0.5
      responses:
        '200':
          description: Cross-pollination suggestions
          content:
            application/json:
              schema:
                type: object
                properties:
                  suggestions:
                    type: array
                    items:
                      $ref: '#/components/schemas/CrossPollinationSuggestion'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # =============================================================================
  # INSIGHTS
  # =============================================================================
  /api/insights/recent:
    get:
      tags: [Insights]
      summary: Get recent insights
      description: Retrieve recently extracted insights from debates
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Recent insights
          content:
            application/json:
              schema:
                type: object
                properties:
                  insights:
                    type: array
                    items:
                      $ref: '#/components/schemas/Insight'

  /api/insights/extract-detailed:
    post:
      tags: [Insights]
      summary: Extract detailed insights from content
      description: Analyze content and extract structured insights
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
                  description: Content to analyze
                context:
                  type: string
                  description: Optional context for analysis
      responses:
        '200':
          description: Extracted insights
          content:
            application/json:
              schema:
                type: object
                properties:
                  insights:
                    type: array
                    items:
                      $ref: '#/components/schemas/Insight'
                  metadata:
                    type: object
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimited'

  # =============================================================================
  # ROUTING (Agent Selection)
  # =============================================================================
  /api/routing/best-teams:
    get:
      tags: [Routing]
      summary: Get best-performing team combinations
      description: Retrieve historical best-performing agent team combinations
      parameters:
        - name: min_debates
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 20
            default: 3
          description: Minimum debates for a team to be considered
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: Best team combinations
          content:
            application/json:
              schema:
                type: object
                properties:
                  min_debates:
                    type: integer
                  combinations:
                    type: array
                    items:
                      $ref: '#/components/schemas/TeamCombination'
                  count:
                    type: integer
        '503':
          description: Agent selector not available

  /api/routing/recommendations:
    post:
      tags: [Routing]
      summary: Get agent recommendations for a task
      description: Get ranked agent recommendations based on task requirements
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                primary_domain:
                  type: string
                  default: general
                  description: Primary domain for the task
                secondary_domains:
                  type: array
                  items:
                    type: string
                required_traits:
                  type: array
                  items:
                    type: string
                task_id:
                  type: string
                limit:
                  type: integer
                  minimum: 1
                  maximum: 20
                  default: 5
      responses:
        '200':
          description: Agent recommendations
          content:
            application/json:
              schema:
                type: object
                properties:
                  recommendations:
                    type: array
                    items:
                      $ref: '#/components/schemas/AgentRecommendation'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '503':
          description: Agent selector not available

  # =============================================================================
  # EVOLUTION
  # =============================================================================
  /api/evolution/patterns:
    get:
      tags: [Evolution]
      summary: Get top evolution patterns
      description: Returns the most successful patterns extracted from winning debate strategies
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [argument, structure, citation, all]
          description: Filter by pattern type
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
          description: Maximum patterns to return
      responses:
        '200':
          description: List of evolution patterns
          content:
            application/json:
              schema:
                type: object
                properties:
                  patterns:
                    type: array
                    items:
                      $ref: '#/components/schemas/EvolutionPattern'
        '503':
          description: Evolution system not available

  /api/evolution/summary:
    get:
      tags: [Evolution]
      summary: Get evolution summary
      description: Returns aggregate statistics about prompt evolution
      responses:
        '200':
          description: Evolution statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_patterns:
                    type: integer
                  agents_evolved:
                    type: integer
                  success_rate:
                    type: number
                    format: float
                  last_evolution:
                    type: string
                    format: date-time

  /api/evolution/{agent}/history:
    get:
      tags: [Evolution]
      summary: Get agent evolution history
      description: Returns prompt evolution history for a specific agent
      parameters:
        - name: agent
          in: path
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: Evolution history
          content:
            application/json:
              schema:
                type: object
                properties:
                  agent:
                    type: string
                  history:
                    type: array
                    items:
                      $ref: '#/components/schemas/EvolutionEvent'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/evolution/{agent}/prompt:
    get:
      tags: [Evolution]
      summary: Get agent prompt
      description: Returns current or specific version of agent's evolved prompt
      parameters:
        - name: agent
          in: path
          required: true
          schema:
            type: string
        - name: version
          in: query
          schema:
            type: integer
          description: Specific version (latest if not provided)
      responses:
        '200':
          description: Agent prompt
          content:
            application/json:
              schema:
                type: object
                properties:
                  agent:
                    type: string
                  version:
                    type: integer
                  prompt:
                    type: string
                  patterns_applied:
                    type: array
                    items:
                      type: string
        '404':
          $ref: '#/components/responses/NotFound'

  # =============================================================================
  # BROADCAST
  # =============================================================================
  /api/debates/{id}/broadcast:
    post:
      tags: [Broadcast]
      summary: Generate podcast audio
      description: Generates podcast-style audio from a debate trace
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                voice_mapping:
                  type: object
                  additionalProperties:
                    type: string
                  description: Agent to voice mapping
                include_intro:
                  type: boolean
                  default: true
                include_outro:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Broadcast generation started
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id:
                    type: string
                  status:
                    type: string
                    enum: [queued, processing, completed, failed]
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '503':
          description: Broadcast system not available

  /api/debates/{id}/broadcast/full:
    post:
      tags: [Broadcast]
      summary: Run full broadcast pipeline
      description: Runs complete broadcast pipeline including TTS, mixing, and publishing
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                platforms:
                  type: array
                  items:
                    type: string
                    enum: [rss, youtube, twitter]
                  default: [rss]
                tts_backend:
                  type: string
                  enum: [elevenlabs, google, openai]
                  default: elevenlabs
      responses:
        '200':
          description: Full pipeline started
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id:
                    type: string
                  status:
                    type: string
                  estimated_duration:
                    type: integer
                    description: Estimated completion time in seconds
        '401':
          $ref: '#/components/responses/Unauthorized'
        '503':
          description: Broadcast pipeline not available

  /api/podcast/feed.xml:
    get:
      tags: [Broadcast]
      summary: Get podcast RSS feed
      description: Returns RSS feed for the Aragora podcast
      responses:
        '200':
          description: RSS feed
          content:
            application/rss+xml:
              schema:
                type: string

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer

  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Invalid or missing authentication token"
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Resource not found"
    RateLimited:
      description: Rate limit exceeded
      headers:
        X-RateLimit-Limit:
          schema:
            type: integer
          description: Request limit per minute
        X-RateLimit-Remaining:
          schema:
            type: integer
          description: Remaining requests in current window
        X-RateLimit-Reset:
          schema:
            type: integer
          description: Unix timestamp when limit resets
        Retry-After:
          schema:
            type: integer
          description: Seconds to wait before retrying
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/APIError'

  schemas:
    DebateStatus:
      type: string
      description: |
        Canonical status values for debates.
        Legacy values (active, concluded, archived, created, in_progress, starting) are normalized in responses.
      enum:
        - created
        - starting
        - pending
        - running
        - in_progress
        - completed
        - failed
        - cancelled
        - paused
        - active
        - concluded
        - archived
      example: running

    ConsensusResult:
      type: object
      properties:
        reached:
          type: boolean
        agreement:
          type: number
          format: float
        confidence:
          type: number
          format: float
        final_answer:
          type: string
        conclusion:
          type: string
        supporting_agents:
          type: array
          items:
            type: string
        dissenting_agents:
          type: array
          items:
            type: string

    DebateCreateRequest:
      type: object
      properties:
        task:
          type: string
          description: The topic or question to debate
          minLength: 1
          maxLength: 2000
        question:
          type: string
          description: Alias for task (legacy field)
          minLength: 1
          maxLength: 2000
        agents:
          type: array
          items:
            type: string
          description: List of agent IDs to include
        rounds:
          type: integer
          description: Number of debate rounds
          minimum: 1
          maximum: 10
          default: 3
        consensus:
          type: string
          description: Consensus detection method
          enum: [majority, unanimous, supermajority, hybrid]
          default: majority
        auto_select:
          type: boolean
          description: Whether to auto-select optimal agents
          default: false
        auto_select_config:
          type: object
          description: Optional auto-select configuration
        use_trending:
          type: boolean
          description: Use a trending topic instead of provided task
          default: false
        trending_category:
          type: string
          description: Trending category filter
        context:
          type: string
          description: Additional context for the debate
          maxLength: 5000

    DebateCreateResponse:
      type: object
      properties:
        success:
          type: boolean
        debate_id:
          type: string
          description: Unique identifier for the created debate
        status:
          $ref: '#/components/schemas/DebateStatus'
        task:
          type: string
          description: The debate topic
        error:
          type: string

    DebateSummary:
      type: object
      properties:
        debate_id:
          type: string
        id:
          type: string
        slug:
          type: string
        task:
          type: string
        status:
          $ref: '#/components/schemas/DebateStatus'
        consensus_reached:
          type: boolean
        confidence:
          type: number
          format: float
        created_at:
          type: string
          format: date-time
        rounds_used:
          type: integer
        duration_seconds:
          type: number
          format: float
        agents:
          type: array
          items:
            type: string
        view_count:
          type: integer
        is_public:
          type: boolean

    Debate:
      type: object
      properties:
        debate_id:
          type: string
        id:
          type: string
        slug:
          type: string
        task:
          type: string
        context:
          type: string
        status:
          $ref: '#/components/schemas/DebateStatus'
        outcome:
          type: string
        final_answer:
          type: string
        consensus:
          $ref: '#/components/schemas/ConsensusResult'
        consensus_proof:
          type: object
        consensus_reached:
          type: boolean
        confidence:
          type: number
          format: float
        rounds_used:
          type: integer
        duration_seconds:
          type: number
          format: float
        agents:
          type: array
          items:
            type: string
        rounds:
          type: array
          items:
            $ref: '#/components/schemas/Round'
        created_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        metadata:
          type: object

    Round:
      type: object
      properties:
        round_number:
          type: integer
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Message'
        critiques:
          type: array
          items:
            $ref: '#/components/schemas/Critique'

    Message:
      type: object
      properties:
        agent_id:
          type: string
        agent:
          type: string
        content:
          type: string
        round:
          type: integer
        timestamp:
          type: string
          format: date-time

    Critique:
      type: object
      properties:
        author:
          type: string
        target:
          type: string
        content:
          type: string
        severity:
          type: number
          format: float

    ImpasseAnalysis:
      type: object
      properties:
        impasse_detected:
          type: boolean
        indicators:
          type: array
          items:
            type: string
        circular_arguments:
          type: array
          items:
            type: object
        repetition_score:
          type: number
          format: float

    ConvergenceStatus:
      type: object
      properties:
        converged:
          type: boolean
        similarity_score:
          type: number
          format: float
        rounds_to_convergence:
          type: integer

    Citations:
      type: object
      properties:
        citations:
          type: array
          items:
            type: object
            properties:
              claim:
                type: string
              source:
                type: string
              confidence:
                type: number
        grounded_verdict:
          type: object

    LeaderboardEntry:
      type: object
      properties:
        rank:
          type: integer
        agent:
          type: string
        elo:
          type: integer
        wins:
          type: integer
        losses:
          type: integer
        win_rate:
          type: number
          format: float

    Match:
      type: object
      properties:
        id:
          type: string
        debate_id:
          type: string
        winner:
          type: string
        loser:
          type: string
        elo_change:
          type: integer
        timestamp:
          type: string
          format: date-time

    AgentProfile:
      type: object
      properties:
        name:
          type: string
        elo:
          type: integer
        rank:
          type: integer
        wins:
          type: integer
        losses:
          type: integer
        win_rate:
          type: number
          format: float
        specialties:
          type: array
          items:
            type: string

    MatchHistoryEntry:
      type: object
      properties:
        debate_id:
          type: string
        opponent:
          type: string
        result:
          type: string
          enum: [win, loss, draw]
        elo_change:
          type: integer
        timestamp:
          type: string
          format: date-time

    ConsistencyScore:
      type: object
      properties:
        agent:
          type: string
        consistency_score:
          type: number
          format: float
        total_flips:
          type: integer
        recent_flips:
          type: integer

    RelationshipNetwork:
      type: object
      properties:
        agent:
          type: string
        rivals:
          type: array
          items:
            $ref: '#/components/schemas/AgentRelation'
        allies:
          type: array
          items:
            $ref: '#/components/schemas/AgentRelation'

    AgentRelation:
      type: object
      properties:
        agent:
          type: string
        score:
          type: number
          format: float
        debates:
          type: integer

    AgentComparison:
      type: object
      properties:
        agents:
          type: array
          items:
            $ref: '#/components/schemas/AgentProfile'
        head_to_head:
          type: object
          additionalProperties:
            type: object

    PositionFlip:
      type: object
      properties:
        agent:
          type: string
        topic:
          type: string
        old_position:
          type: string
        new_position:
          type: string
        debate_id:
          type: string
        timestamp:
          type: string
          format: date-time

    DetailedHealth:
      type: object
      properties:
        status:
          type: string
        observers:
          type: object
        memory:
          type: object
        uptime_seconds:
          type: number

    NomicState:
      type: object
      properties:
        phase:
          type: string
        cycle:
          type: integer
        loop_id:
          type: string
        last_update:
          type: string
          format: date-time

    NomicHealth:
      type: object
      properties:
        healthy:
          type: boolean
        stalled:
          type: boolean
        last_activity:
          type: string
          format: date-time

    Mode:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        builtin:
          type: boolean

    SimilarDebate:
      type: object
      properties:
        debate_id:
          type: string
        topic:
          type: string
        similarity:
          type: number
          format: float
        outcome:
          type: string

    SettledTopic:
      type: object
      properties:
        topic:
          type: string
        consensus:
          type: string
        confidence:
          type: number
          format: float
        debate_count:
          type: integer

    ConsensusStats:
      type: object
      properties:
        total_topics:
          type: integer
        settled_count:
          type: integer
        average_confidence:
          type: number
          format: float

    Dissent:
      type: object
      properties:
        agent:
          type: string
        topic:
          type: string
        position:
          type: string
        debate_id:
          type: string

    Memory:
      type: object
      properties:
        id:
          type: string
        content:
          type: string
        tier:
          type: string
          enum: [fast, medium, slow, glacial]
        importance:
          type: number
          format: float
        created_at:
          type: string
          format: date-time

    TierStats:
      type: object
      properties:
        fast:
          $ref: '#/components/schemas/TierInfo'
        medium:
          $ref: '#/components/schemas/TierInfo'
        slow:
          $ref: '#/components/schemas/TierInfo'
        glacial:
          $ref: '#/components/schemas/TierInfo'

    TierInfo:
      type: object
      properties:
        count:
          type: integer
        avg_importance:
          type: number
          format: float

    Tournament:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        status:
          type: string
        participants:
          type: integer

    TournamentStandings:
      type: object
      properties:
        tournament_id:
          type: string
        standings:
          type: array
          items:
            type: object
            properties:
              rank:
                type: integer
              agent:
                type: string
              points:
                type: integer

    ReplaySummary:
      type: object
      properties:
        id:
          type: string
        debate_id:
          type: string
        event_count:
          type: integer
        created_at:
          type: string
          format: date-time

    Replay:
      type: object
      properties:
        id:
          type: string
        events:
          type: array
          items:
            type: object
        total_events:
          type: integer

    DocumentSummary:
      type: object
      properties:
        id:
          type: string
        filename:
          type: string
        word_count:
          type: integer
        preview:
          type: string

    Document:
      type: object
      properties:
        id:
          type: string
        filename:
          type: string
        content_type:
          type: string
        text:
          type: string
        page_count:
          type: integer
        word_count:
          type: integer

    SupportedFormats:
      type: object
      properties:
        formats:
          type: array
          items:
            type: object
            properties:
              ext:
                type: string
              mime:
                type: string
              available:
                type: boolean
        max_size_mb:
          type: integer

    VerificationStatus:
      type: object
      properties:
        z3_available:
          type: boolean
        lean_available:
          type: boolean

    VerificationResult:
      type: object
      properties:
        verified:
          type: boolean
        backend:
          type: string
        proof:
          type: string
        counterexample:
          type: string

    DisagreementStats:
      type: object
      properties:
        total_disagreements:
          type: integer
        avg_severity:
          type: number
          format: float

    RankingStats:
      type: object
      properties:
        total_agents:
          type: integer
        total_matches:
          type: integer
        avg_elo:
          type: number
          format: float

    RelationshipSummary:
      type: object
      properties:
        total_relationships:
          type: integer
        rivalries:
          type: integer
        alliances:
          type: integer

    RelationshipGraph:
      type: object
      properties:
        nodes:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              elo:
                type: integer
        edges:
          type: array
          items:
            type: object
            properties:
              source:
                type: string
              target:
                type: string
              weight:
                type: number

    Relationship:
      type: object
      properties:
        agent_a:
          type: string
        agent_b:
          type: string
        debates:
          type: integer
        wins_a:
          type: integer
        wins_b:
          type: integer
        relationship_type:
          type: string
          enum: [rival, ally, neutral]

    MomentsSummary:
      type: object
      properties:
        total_moments:
          type: integer
        by_type:
          type: object
          additionalProperties:
            type: integer

    Moment:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [upset_victory, position_reversal, calibration_vindication, alliance_shift, consensus_breakthrough, streak_achievement, domain_mastery]
        agent:
          type: string
        description:
          type: string
        significance:
          type: number
          format: float
        timestamp:
          type: string
          format: date-time

    DashboardMetrics:
      type: object
      properties:
        debates_count:
          type: integer
        consensus_rate:
          type: number
          format: float
        avg_rounds:
          type: number
          format: float
        top_agents:
          type: array
          items:
            $ref: '#/components/schemas/LeaderboardEntry'
        recent_debates:
          type: array
          items:
            $ref: '#/components/schemas/DebateSummary'

    TrendingTopic:
      type: object
      properties:
        title:
          type: string
        source:
          type: string
          enum: [hackernews, reddit, twitter]
        url:
          type: string
        score:
          type: integer

    SchedulerStatus:
      type: object
      properties:
        state:
          type: string
          enum: [stopped, running, paused]
        run_id:
          type: string
        config:
          type: object
          properties:
            poll_interval_seconds:
              type: integer
            max_debates_per_hour:
              type: integer
            min_volume_threshold:
              type: integer
            min_controversy_score:
              type: number
            dedup_window_hours:
              type: integer
        metrics:
          type: object
          properties:
            polls_completed:
              type: integer
            topics_evaluated:
              type: integer
            topics_filtered:
              type: integer
            debates_created:
              type: integer
            debates_failed:
              type: integer
            duplicates_skipped:
              type: integer
            last_poll_at:
              type: number
            last_debate_at:
              type: number
            uptime_seconds:
              type: number

    ScheduledDebateRecord:
      type: object
      properties:
        id:
          type: string
        topic_hash:
          type: string
        topic_text:
          type: string
        platform:
          type: string
        category:
          type: string
        volume:
          type: integer
        debate_id:
          type: string
          nullable: true
        created_at:
          type: number
        consensus_reached:
          type: boolean
          nullable: true
        confidence:
          type: number
          nullable: true
        rounds_used:
          type: integer
        scheduler_run_id:
          type: string

    # =============================================================================
    # Structured Error Response
    # =============================================================================
    APIError:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Machine-readable error code
              enum: [VALIDATION_ERROR, INVALID_REQUEST, NOT_FOUND, UNAUTHORIZED, FORBIDDEN, RATE_LIMITED, INTERNAL_ERROR, SERVICE_UNAVAILABLE, TIMEOUT]
            message:
              type: string
              description: Human-readable error message
            status:
              type: integer
              description: HTTP status code
            trace_id:
              type: string
              description: Trace ID for debugging
            details:
              type: object
              description: Additional error details
            suggestion:
              type: string
              description: Suggested action to resolve the error

    # =============================================================================
    # Probes Schemas
    # =============================================================================
    ProbeReport:
      type: object
      properties:
        report_id:
          type: string
        target_agent:
          type: string
        probes_run:
          type: integer
        vulnerabilities_found:
          type: integer
        vulnerability_rate:
          type: number
          format: float
        elo_penalty:
          type: number
          format: float
        by_type:
          type: object
          additionalProperties:
            type: object
            properties:
              passed:
                type: integer
              failed:
                type: integer
              severity:
                type: string
        summary:
          type: object
          properties:
            critical:
              type: integer
            high:
              type: integer
            medium:
              type: integer
            low:
              type: integer

    # =============================================================================
    # Laboratory Schemas
    # =============================================================================
    EmergentTrait:
      type: object
      properties:
        agent:
          type: string
        trait:
          type: string
        domain:
          type: string
        confidence:
          type: number
          format: float
        evidence:
          type: array
          items:
            type: string
        detected_at:
          type: string
          format: date-time

    CrossPollinationSuggestion:
      type: object
      properties:
        source_agent:
          type: string
        target_agent:
          type: string
        trait:
          type: string
        benefit_score:
          type: number
          format: float
        rationale:
          type: string

    # =============================================================================
    # Insights Schemas
    # =============================================================================
    Insight:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [pattern, consensus, disagreement, breakthrough, risk]
        title:
          type: string
        description:
          type: string
        confidence:
          type: number
          format: float
        agents_involved:
          type: array
          items:
            type: string
        evidence:
          type: array
          items:
            type: string
        created_at:
          type: string
          format: date-time

    # =============================================================================
    # Routing Schemas
    # =============================================================================
    TeamCombination:
      type: object
      properties:
        agents:
          type: array
          items:
            type: string
        debates:
          type: integer
        consensus_rate:
          type: number
          format: float
        avg_rounds:
          type: number
          format: float
        win_rate:
          type: number
          format: float

    AgentRecommendation:
      type: object
      properties:
        agent:
          type: string
        score:
          type: number
          format: float
        reasons:
          type: array
          items:
            type: string
        domain_fit:
          type: number
          format: float
        trait_match:
          type: number
          format: float

    # =============================================================================
    # Evolution Schemas
    # =============================================================================
    EvolutionPattern:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [argument, structure, citation, rhetorical]
        pattern:
          type: string
          description: The extracted pattern text
        success_rate:
          type: number
          format: float
        usage_count:
          type: integer
        agents_using:
          type: array
          items:
            type: string
        extracted_from:
          type: string
          description: Debate ID where pattern was first seen
        created_at:
          type: string
          format: date-time

    EvolutionEvent:
      type: object
      properties:
        version:
          type: integer
        timestamp:
          type: string
          format: date-time
        strategy:
          type: string
          enum: [append, replace, refine]
        patterns_applied:
          type: array
          items:
            type: string
        success_rate_before:
          type: number
          format: float
        success_rate_after:
          type: number
          format: float
        prompt_diff:
          type: string
          description: Summary of changes made
