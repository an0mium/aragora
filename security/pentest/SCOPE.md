# External Penetration Test - Scope Document

Last updated: 2026-02-25

## 1. Application Overview

Aragora is a multi-agent Decision Integrity Platform. It orchestrates 42+ AI agent types to adversarially vet decisions, producing audit-ready decision receipts. The platform serves SMBs and enterprises via REST API (2,000+ operations), WebSocket streaming (190+ event types), Python/TypeScript SDKs, CLI, and web UI.

**Tech stack**: Python 3.12 (aiohttp + FastAPI), TypeScript/React (Next.js), PostgreSQL/SQLite, Redis, Docker.

## 2. In-Scope Surfaces

### 2.1 Authentication (CRITICAL)

| Surface | Location | Test Focus |
|---------|----------|------------|
| Credential auth | `/api/auth/login`, `/register` | Brute force, credential stuffing, lockout bypass |
| JWT lifecycle | `/api/auth/refresh`, `/logout`, `/logout-all` | Token replay, refresh rotation, blacklist effectiveness |
| OIDC/SAML SSO | `/api/auth/sso/*` | Redirect validation, state parameter, token exchange |
| MFA (TOTP/HOTP) | `/api/auth/mfa/*` | Bypass, backup code reuse, enrollment race conditions |
| API keys | `/api/auth/api-keys/*` | Key enumeration, privilege escalation, revocation |
| Session management | `aragora/auth/session_monitor.py` | Session fixation, concurrent sessions, token version invalidation |
| Password reset | `/api/auth/forgot-password`, `/reset-password` | Token predictability, reuse, timing attacks |
| Account lockout | `aragora/auth/lockout.py` | Bypass via IP rotation, distributed brute force |
| Impersonation | `aragora/auth/impersonation.py` | Audit trail completeness, privilege boundaries |

### 2.2 Authorization (CRITICAL)

| Surface | Location | Test Focus |
|---------|----------|------------|
| RBAC v2 | `aragora/rbac/` (35+ files, 55+ permissions) | Privilege escalation, horizontal access, permission bypass |
| Middleware | `aragora/rbac/middleware.py` | Route enforcement gaps, wildcard handling |
| Conditional access | `aragora/rbac/conditions.py` | IP-based bypass, time-based circumvention |
| Delegation | `aragora/rbac/delegation.py` | Expired delegation reuse, over-delegation |
| Multi-tenancy | `aragora/tenancy/isolation.py` | Cross-tenant data access, org_id boundary |
| Resource ownership | `aragora/rbac/ownership.py` | IDOR via resource_id manipulation |

### 2.3 API Security (HIGH)

| Surface | Scope | Test Focus |
|---------|-------|------------|
| REST endpoints | 706 handler modules, 2,000+ operations | Input validation, injection, mass assignment |
| Path parameters | `extract_path_param()` in handlers | Path traversal, parameter tampering |
| Request bodies | JSON payloads across POST/PUT/PATCH | Schema bypass, unexpected field injection |
| Response data | `{"data": {...}}` envelope pattern | Information leakage, verbose errors |
| File upload | `aragora/server/upload_rate_limit.py` | Size limits, type bypass, storage DoS |
| OpenAPI spec | `docs/api/openapi.json` | Undocumented endpoint discovery |

### 2.4 Injection Prevention (HIGH)

| Vector | Control | Test Focus |
|--------|---------|------------|
| SQL injection | Parameterized queries (`?` placeholders) | Second-order injection, stored procedures |
| SSRF | `aragora/security/ssrf_protection.py` | DNS rebinding, protocol smuggling, redirect chains |
| XSS | CSP headers, `html.escape()` | Stored XSS in debate content, reflected XSS in search |
| Command injection | `shell=True` eliminated (M-3 resolved) | Indirect command injection via agent prompts |
| Template injection | Server-side rendering in receipts/reports | SSTI via debate content flowing to templates |

### 2.5 Encryption & Key Management (HIGH)

| Surface | Implementation | Test Focus |
|---------|---------------|------------|
| At-rest encryption | AES-256-GCM, PBKDF2-SHA256 (100k iter) | Nonce reuse, key recovery, downgrade attacks |
| Key rotation | `aragora/security/key_rotation.py` | Rotation gaps, old key validity window |
| API key storage | SHA-256 hashed | Timing attacks on comparison |
| Secrets management | AWS Secrets Manager / `.env` | Secret exposure in logs, error messages |

### 2.6 WebSocket & Streaming (MEDIUM)

| Surface | Location | Test Focus |
|---------|----------|------------|
| WebSocket auth | Bearer token in upgrade request | Auth bypass, token replay |
| Event streaming | 190+ event types | Message injection, event spoofing |
| Rate limiting | Per-connection limits | Connection flood, slowloris |
| Voice/TTS | `aragora/server/stream/voice_stream.py` | Session hijacking, audio interception |
| Oracle streaming | `aragora/server/stream/oracle_stream.py` | Debate state manipulation |

### 2.7 Code Execution & Sandbox (MEDIUM)

| Surface | Location | Test Focus |
|---------|----------|------------|
| Docker sandbox | `aragora/sandbox/executor.py` | Container escape, resource exhaustion |
| Execution policies | `aragora/sandbox/policies.py` | Policy bypass, network isolation evasion |
| Container pool | `aragora/sandbox/pool.py` | Pool poisoning, state leakage between executions |

### 2.8 Third-Party Integrations (MEDIUM)

| Surface | Scope | Test Focus |
|---------|-------|------------|
| Webhook verification | Slack/Discord/GitHub/Teams | Signature bypass, replay attacks |
| OAuth flows | 40+ connector integrations | Token theft, redirect manipulation |
| AI provider APIs | Anthropic, OpenAI, Mistral, Grok | Prompt injection, response manipulation |
| MCP server | `aragora/mcp/server.py` | Tool whitelisting bypass |

## 3. Out-of-Scope

- Physical security and social engineering
- Denial-of-service attacks against production infrastructure
- Zero-day exploitation of third-party dependencies (covered by CI gates)
- Supply chain attacks beyond dependency vulnerability scanning
- Mobile applications (none exist)

## 4. Existing Security Controls

### CI/CD Security Gates (automated, every push)
- CodeQL SAST (Python, JavaScript)
- Bandit (Python security linter, HIGH severity blocking)
- pip-audit + Safety (dependency vulnerabilities)
- npm audit (HIGH/CRITICAL blocking)
- Gitleaks + TruffleHog (secret scanning)
- RBAC coverage audit (min 55% decorator coverage)
- Pentest findings gate (`scripts/check_pentest_findings.py`)

### Self-Assessment Findings (all resolved)
- 0 CRITICAL, 0 HIGH open
- 2 HIGH resolved (`.env_backups` gitignore, HTML injection in password reset)
- 5 MEDIUM (4 resolved, 1 accepted risk â€” custom JWT in billing, documented)
- Tracking: `security/pentest/findings.json`

### Security Testing Framework
- Gauntlet: 1,300+ security-focused tests with compliance personas (GDPR, HIPAA, SOX, PCI-DSS, SOC2)
- 151,000+ total tests across 3,000+ test files
- Circuit breaker + retry patterns on all 151 production connectors

## 5. Test Environment

- **Demo mode**: `aragora serve --demo` (starts in ~14s, no external API keys needed)
- **Database**: SQLite (default) or PostgreSQL
- **Container deployment**: `docker-compose.yml` provides full stack
- **Credentials**: Will be provided via secure channel upon engagement

## 6. Deliverables Expected

1. Vulnerability report with CVSS scoring
2. Proof-of-concept for each finding
3. Remediation recommendations
4. Executive summary
5. Re-test validation after remediation

## 7. Reference Documents

| Document | Path |
|----------|------|
| Execution plan | `security/pentest/EXECUTION_PLAN.md` |
| Findings tracker | `security/pentest/findings.json` |
| Vendor outreach log | `security/pentest/VENDOR_OUTREACH_LOG.md` |
| API reference | `docs/api/openapi.json` |
| Security controls | `aragora/security/` |
| RBAC implementation | `aragora/rbac/` |
| Auth implementation | `aragora/auth/` |
